import{q as De,u as Se,r as i,a7 as Q,w as W,d as re,e as c,o as X,f as Pe,j as n,i as d,g as t,h as o,y as p,a8 as Y,t as f,K as ue,Q as Ne,D as Z,a9 as ee,X as Te,k as je,l as Oe,a5 as Je,E as u,m as S,p as Ae,n as Be,_ as Ee}from"./index-4d5b55f1.js";import{_ as Fe}from"./111-95b7bfc1.js";const te=P=>(Ae("data-v-1b988f2a"),P=P(),Be(),P),He={style:{"border-radius":"20px 0 0 0","box-shadow":"-10px -2.5px 0 0 rgb(225, 235, 248)"}},Re={class:"member-header"},qe={class:"table-first-content"},Ge=["src"],Ke={class:"table-member-nickname"},Qe={slot:"empty"},We=te(()=>n("img",{src:Fe,alt:""},null,-1)),Xe={class:"table-first-content"},Ye=["src"],Ze={class:"table-member-nickname"},et={class:"table-first-content"},tt=["src"],at={class:"table-member-nickname"},lt={class:"table-first-content"},ot=["src"],nt={class:"table-member-nickname"},st={class:"dialog-footer"},rt=te(()=>n("span",null,"请确认是否将该成员移出团队！",-1)),ut={class:"dialog-footer"},it=te(()=>n("div",{style:{"margin-bottom":"20px","font-size":"16px"}},"请选择该成员的身份权限：",-1)),dt={style:{display:"flex","justify-content":"center"}},mt={class:"dialog-footer"},ct={class:"invite-link-content"},pt=te(()=>n("span",{class:"invite-link-title"},"邀请链接：",-1)),gt={class:"dialog-footer"},ft="140px",vt=De({__name:"Members",setup(P){const b=Se(),w=i(""),N=i(!1),T=i(b.state.Group.members);function y(){return b.getters.getUserinfo}function x(){return b.state.User.currentTeam.id}function j(){const l=b.getters.getMembers;for(let e of l)if(e.id===y().user_id)return e}function fe(){let l=j();l.status=="创建者"||l.status=="管理员"?(u({message:"请输入您想邀请的成员ID！",type:"success"}),F.value=!0):u({message:"您的权限不够，请联系团队创建人或管理员邀请成员！",type:"warning"})}function O(l){let e=j();l.status=="管理员"&&e.status=="创建者"||l.status=="普通成员"&&(e.status=="创建者"||e.status=="管理员")?(M.value=!0,H.id=l.id):l.status=="创建者"&&e.status=="创建者"?u({message:"作为团队的创建人，您不可以将自己移出团队！",type:"warning"}):l.status=="管理员"&&e.status=="管理员"?u({message:"您的权限不够，请联系团队创建人移除该成员！",type:"warning"}):l.status=="创建者"?u({message:"您的权限不够，无法将创建人移出团队！",type:"warning"}):u({message:"您的权限不够，请联系团队创建人或管理员移除该成员！",type:"warning"})}function J(l){let e=j();l.status=="管理员"&&e.status=="创建者"||l.status=="普通成员"&&(e.status=="创建者"||e.status=="管理员")?(z.value=!0,I.id=l.id):l.status=="创建者"&&e.status=="创建者"?u({message:"作为团队的创建人，您不可以修改自己的身份权限！",type:"warning"}):l.status=="管理员"?u({message:"您的权限不够，请联系团队创建人修改该成员权限！",type:"warning"}):l.status=="创建者"?u({message:"您的权限不够，无法修改创建人的身份权限！",type:"warning"}):u({message:"您的权限不够，请联系团队创建人或管理员修改该成员权限！",type:"warning"})}function ve(){S({url:"#/api/v1/team_manage/invite_member",method:"post",data:JSON.stringify({token:y().token,team_id:x(),invitee_name:C.name})}).then(l=>{if(C.name="",l.data.errno===1004){u.error("被邀请用户不存在！");return}if(l.data.errno===1005){u.error("您不在这个团队中！");return}if(l.data.errno===1006){u.error("您邀请的用户已在该团队中！");return}if(l.data.errno===1007){u.error("您已向该用户发送过邀请，请耐心等待！");return}u({message:"已向目标用户发送邀请，请等待对方同意！",type:"success"})}).catch(l=>{console.log(l)})}function _e(){M.value=!1,S({url:"#/api/v1/team_manage/delete_member",method:"post",data:JSON.stringify({token:y().token,team_id:x(),delete_user_id:H.id})}).then(l=>{if(l.data.errno===1003){u.error("该团队不存在！");return}if(l.data.errno===1004){u.error("不存在该用户！");return}b.commit("removeMember",H.id),H.id=-1,u({message:"已将该用户移出团队！",type:"success"})}).catch(l=>{console.log(l)})}function be(){if(z.value=!1,R.value==1){let l={id:I.id,sta:"管理员"};S({url:"#/api/v1/team_manage/grant_admin",method:"post",data:JSON.stringify({token:y().token,granted_user_id:I.id,team_id:x()})}).then(e=>{b.commit("editMember",l),u({message:"已将该用户设为管理员！",type:"success"}),console.log(b.getters.getMembers)}).catch(e=>{console.log(e)})}else if(R.value==2){let l={id:I.id,sta:"普通成员"};S({url:"#/api/v1/team_manage/dismiss_admin",method:"post",data:JSON.stringify({token:y().token,granted_user_id:I.id,team_id:x()})}).then(e=>{b.commit("editMember",l),u({message:"已将该用户设为普通成员！",type:"success"})}).catch(e=>{console.log(e)})}}function we(){let l=j();l.status=="创建者"||l.status=="管理员"?(console.log("生成链接"),S({url:"#/api/v1/team_manage/generate_team_link",method:"post",data:JSON.stringify({token:y().token,team_id:x()})}).then(e=>{console.log("string:"+e.data.data),w.value=e.data.data,ke()}).catch(e=>{console.log(e)})):u({message:"您的权限不够，请联系团队创建人或管理员邀请成员！",type:"warning"})}function ke(){const l=w.value,e=l.lastIndexOf("/"),g=l.lastIndexOf("/",e-1),se=l.slice(g+1,e),r=l.slice(e+1);w.value="http://82.156.154.154/#/"+se+"/"+r,console.log(w.value),N.value=!0}function ye(){const l=w.value;navigator.clipboard.writeText(l),u.success("复制链接成功")}const ie=i("all"),s=i(""),ae=Q(()=>T.value.filter(l=>!s.value||l.name.toLowerCase().includes(s.value.toLowerCase())||l.status.toLowerCase().includes(s.value.toLowerCase())||l.nickname.toLowerCase().includes(s.value.toLowerCase()))),le=Q(()=>T.value.filter(l=>(!s.value||l.name.toLowerCase().includes(s.value.toLowerCase())||l.status.toLowerCase().includes(s.value.toLowerCase())||l.nickname.toLowerCase().includes(s.value.toLowerCase()))&&l.status=="创建者")),oe=Q(()=>T.value.filter(l=>(!s.value||l.name.toLowerCase().includes(s.value.toLowerCase())||l.status.toLowerCase().includes(s.value.toLowerCase())||l.nickname.toLowerCase().includes(s.value.toLowerCase()))&&l.status=="管理员")),ne=Q(()=>T.value.filter(l=>(!s.value||l.name.toLowerCase().includes(s.value.toLowerCase())||l.status.toLowerCase().includes(s.value.toLowerCase())||l.nickname.toLowerCase().includes(s.value.toLowerCase()))&&l.status=="普通成员"));function Ce(){return ae.value.sort(function(e,g){return e.status.localeCompare(g.status,"zh")})}const m=i(9),A=i(!1),B=i(!0),E=i(!1),V=i(1),de=i(ae.value.length);W(()=>ae.value.length,l=>{de.value=l});const he=l=>{console.log(`current page: ${l}`),V.value=l},L=i(1),me=i(le.value.length);W(()=>le.value.length,l=>{me.value=l});const xe=l=>{console.log(`current page: ${l}`),L.value=l},U=i(1),ce=i(oe.value.length);W(()=>oe.value.length,l=>{ce.value=l});const Ve=l=>{console.log(`current page: ${l}`),U.value=l},$=i(1),pe=i(ne.value.length);W(()=>ne.value.length,l=>{pe.value=l});const Le=l=>{console.log(`current page: ${l}`),$.value=l},F=i(!1),C=re({name:""}),M=i(!1),H=re({id:-1}),z=i(!1),I=re({id:-1}),R=i(-1);return(l,e)=>{const g=c("el-button"),se=c("el-button-group"),r=c("el-table-column"),h=c("el-tag"),D=c("el-input"),v=c("el-icon"),_=c("el-tooltip"),Ue=c("P"),q=c("el-pagination"),G=c("el-tab-pane"),$e=c("el-tabs"),Me=c("el-form-item"),ze=c("el-form"),K=c("el-dialog"),ge=c("el-radio"),Ie=c("el-radio-group");return X(),Pe("div",He,[n("div",Re,[n("span",null,[d(" 成员 "),t(se,{style:{"margin-left":"1238px","margin-top":"10px","font-size":"16px"}},{default:o(()=>[t(g,{type:"primary",style:{"background-color":"#1b9aee !important"},onClick:e[0]||(e[0]=a=>fe())},{default:o(()=>[d("邀请成员")]),_:1}),t(g,{type:"primary",style:{"background-color":"#1b9aee !important"},onClick:e[1]||(e[1]=a=>we())},{default:o(()=>[d("生成邀请链接")]),_:1})]),_:1})])]),t($e,{modelValue:ie.value,"onUpdate:modelValue":e[14]||(e[14]=a=>ie.value=a),class:"demo-tabs",style:{margin:"0 35px"}},{default:o(()=>[t(G,{label:"所有人",name:"all"},{default:o(()=>[t(p(Y),{data:Ce().slice((V.value-1)*m.value,V.value*m.value),"highlight-current-row":"","row-style":{height:"67px"},class:"memberTable"},{default:o(()=>[t(r,{property:"current_date",label:"成员昵称",width:"300"},{default:o(a=>[n("div",qe,[n("img",{class:"table-member-avatar",src:a.row.avatar,alt:""},null,8,Ge),n("div",Ke,f(a.row.nickname),1)])]),_:1}),t(r,{property:"name",label:"姓名",width:"200"}),t(r,{label:"身份",width:"300"},{default:o(a=>[a.row.status=="创建者"?(X(),ue(h,{key:0,class:"ml-2"},{default:o(()=>[d(f(a.row.status),1)]),_:2},1024)):a.row.status=="管理员"?(X(),ue(h,{key:1,class:"ml-2",type:"success"},{default:o(()=>[d(f(a.row.status),1)]),_:2},1024)):a.row.status=="普通成员"?(X(),ue(h,{key:2,class:"ml-2",type:"info"},{default:o(()=>[d(f(a.row.status),1)]),_:2},1024)):Ne("",!0)]),_:1}),t(r,{property:"email",label:"邮箱",width:"400"}),t(r,{align:"right"},{header:o(()=>[t(D,{modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value=a),size:"default",placeholder:"输入成员的ID、昵称、姓名以搜索"},null,8,["modelValue"])]),default:o(a=>[t(_,{class:"box-item",effect:"dark",content:"更改成员权限",placement:"top"},{default:o(()=>[t(v,{class:"option-image",onClick:k=>J(a.row)},{default:o(()=>[t(p(Z))]),_:2},1032,["onClick"])]),_:2},1024),t(_,{class:"box-item",effect:"dark",content:"移除成员",placement:"top-end"},{default:o(()=>[t(v,{class:"option-image_delete",onClick:k=>O(a.row)},{default:o(()=>[t(p(ee))]),_:2},1032,["onClick"])]),_:2},1024)]),_:1}),n("template",Qe,[We,t(Ue,null,{default:o(()=>[d(" 写自己的提示文字")]),_:1})])]),_:1},8,["data"]),t(q,{"current-page":V.value,"onUpdate:currentPage":e[3]||(e[3]=a=>V.value=a),"page-size":m.value,"onUpdate:pageSize":e[4]||(e[4]=a=>m.value=a),small:A.value,disabled:E.value,background:B.value,layout:"total, prev, pager, next, jumper",class:"table_pagination",total:de.value,onCurrentChange:he},null,8,["current-page","page-size","small","disabled","background","total"])]),_:1}),t(G,{label:"创建人",name:"head"},{default:o(()=>[t(p(Y),{data:le.value.slice((L.value-1)*m.value,L.value*m.value),"highlight-current-row":"","row-style":{height:"67px"},class:"memberTable"},{default:o(()=>[t(r,{property:"current_date",label:"成员昵称",width:"200"},{default:o(a=>[n("div",Xe,[n("img",{class:"table-member-avatar",src:a.row.avatar,alt:""},null,8,Ye),n("div",Ze,f(a.row.nickname),1)])]),_:1}),t(r,{property:"name",label:"姓名",width:"200"}),t(r,{label:"身份",width:"300"},{default:o(a=>[t(h,{class:"ml-2"},{default:o(()=>[d(f(a.row.status),1)]),_:2},1024)]),_:1}),t(r,{property:"email",label:"邮箱",width:"400"}),t(r,{align:"right"},{header:o(()=>[t(D,{modelValue:s.value,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value=a),size:"default",placeholder:"输入成员的ID、昵称、姓名以搜索"},null,8,["modelValue"])]),default:o(a=>[t(_,{class:"box-item",effect:"dark",content:"更改成员权限",placement:"top"},{default:o(()=>[t(v,{class:"option-image",onClick:k=>J(a.row)},{default:o(()=>[t(p(Z))]),_:2},1032,["onClick"])]),_:2},1024),t(_,{class:"box-item",effect:"dark",content:"移除成员",placement:"top-end"},{default:o(()=>[t(v,{class:"option-image_delete",onClick:k=>O(a.row)},{default:o(()=>[t(p(ee))]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),t(q,{"current-page":L.value,"onUpdate:currentPage":e[6]||(e[6]=a=>L.value=a),"page-size":m.value,"onUpdate:pageSize":e[7]||(e[7]=a=>m.value=a),small:A.value,disabled:E.value,background:B.value,layout:"total, prev, pager, next, jumper",class:"table_pagination",total:me.value,onCurrentChange:xe},null,8,["current-page","page-size","small","disabled","background","total"])]),_:1}),t(G,{label:"管理员",name:"manager"},{default:o(()=>[t(p(Y),{data:oe.value.slice((U.value-1)*m.value,U.value*m.value),"highlight-current-row":"","row-style":{height:"67px"},class:"memberTable"},{default:o(()=>[t(r,{property:"current_date",label:"成员昵称",width:"200"},{default:o(a=>[n("div",et,[n("img",{class:"table-member-avatar",src:a.row.avatar,alt:""},null,8,tt),n("div",at,f(a.row.nickname),1)])]),_:1}),t(r,{property:"name",label:"姓名",width:"200"}),t(r,{label:"身份",width:"300"},{default:o(a=>[t(h,{class:"ml-2",type:"success"},{default:o(()=>[d(f(a.row.status),1)]),_:2},1024)]),_:1}),t(r,{property:"email",label:"邮箱",width:"400"}),t(r,{align:"right"},{header:o(()=>[t(D,{modelValue:s.value,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value=a),size:"default",placeholder:"输入成员的ID、昵称、姓名以搜索"},null,8,["modelValue"])]),default:o(a=>[t(_,{class:"box-item",effect:"dark",content:"更改成员权限",placement:"top"},{default:o(()=>[t(v,{class:"option-image",onClick:k=>J(a.row)},{default:o(()=>[t(p(Z))]),_:2},1032,["onClick"])]),_:2},1024),t(_,{class:"box-item",effect:"dark",content:"移除成员",placement:"top-end"},{default:o(()=>[t(v,{class:"option-image_delete",onClick:k=>O(a.row)},{default:o(()=>[t(p(ee))]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),t(q,{"current-page":U.value,"onUpdate:currentPage":e[9]||(e[9]=a=>U.value=a),"page-size":m.value,"onUpdate:pageSize":e[10]||(e[10]=a=>m.value=a),small:A.value,disabled:E.value,background:B.value,layout:"total, prev, pager, next, jumper",class:"table_pagination",total:ce.value,onCurrentChange:Ve},null,8,["current-page","page-size","small","disabled","background","total"])]),_:1}),t(G,{label:"参与人",name:"player"},{default:o(()=>[t(p(Y),{data:ne.value.slice(($.value-1)*m.value,$.value*m.value),"highlight-current-row":"","row-style":{height:"67px"},class:"memberTable"},{default:o(()=>[t(r,{property:"current_date",label:"成员昵称",width:"200"},{default:o(a=>[n("div",lt,[n("img",{class:"table-member-avatar",src:a.row.avatar,alt:""},null,8,ot),n("div",nt,f(a.row.nickname),1)])]),_:1}),t(r,{property:"name",label:"姓名",width:"200"}),t(r,{label:"身份",width:"300"},{default:o(a=>[t(h,{class:"ml-2",type:"info"},{default:o(()=>[d(f(a.row.status),1)]),_:2},1024)]),_:1}),t(r,{property:"email",label:"邮箱",width:"400"}),t(r,{align:"right"},{header:o(()=>[t(D,{modelValue:s.value,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value=a),size:"default",placeholder:"输入成员的ID、昵称、姓名以搜索"},null,8,["modelValue"])]),default:o(a=>[t(_,{class:"box-item",effect:"dark",content:"更改成员权限",placement:"top"},{default:o(()=>[t(v,{class:"option-image",onClick:k=>J(a.row)},{default:o(()=>[t(p(Z))]),_:2},1032,["onClick"])]),_:2},1024),t(_,{class:"box-item",effect:"dark",content:"移除成员",placement:"top-end"},{default:o(()=>[t(v,{class:"option-image_delete",onClick:k=>O(a.row)},{default:o(()=>[t(p(ee))]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"]),t(q,{"current-page":$.value,"onUpdate:currentPage":e[12]||(e[12]=a=>$.value=a),"page-size":m.value,"onUpdate:pageSize":e[13]||(e[13]=a=>m.value=a),small:A.value,disabled:E.value,background:B.value,layout:"total, prev, pager, next, jumper",class:"table_pagination",total:pe.value,onCurrentChange:Le},null,8,["current-page","page-size","small","disabled","background","total"])]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:F.value,"onUpdate:modelValue":e[18]||(e[18]=a=>F.value=a),title:"邀请成员",onClose:e[19]||(e[19]=a=>C.name=""),width:"40%"},{footer:o(()=>[n("span",st,[t(g,{onClick:e[16]||(e[16]=a=>F.value=!1)},{default:o(()=>[d("取消")]),_:1}),t(g,{type:"primary",style:{"background-color":"#1b9aee !important"},onClick:e[17]||(e[17]=a=>ve())},{default:o(()=>[d(" 确认 ")]),_:1})])]),default:o(()=>[t(ze,{model:C},{default:o(()=>[t(Me,{label:"用户名","label-width":ft},{default:o(()=>[t(D,{modelValue:C.name,"onUpdate:modelValue":e[15]||(e[15]=a=>C.name=a),autocomplete:"off",style:{width:"75%"},placeholder:"请输入用户名","prefix-icon":p(Te)},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(K,{modelValue:M.value,"onUpdate:modelValue":e[22]||(e[22]=a=>M.value=a),title:"移出成员",width:"30%"},{footer:o(()=>[n("span",ut,[t(g,{onClick:e[20]||(e[20]=a=>M.value=!1)},{default:o(()=>[d("取消")]),_:1}),t(g,{type:"primary",style:{"background-color":"#1b9aee !important"},onClick:e[21]||(e[21]=a=>_e())},{default:o(()=>[d(" 确认 ")]),_:1})])]),default:o(()=>[rt]),_:1},8,["modelValue"]),t(K,{modelValue:z.value,"onUpdate:modelValue":e[26]||(e[26]=a=>z.value=a),title:"修改成员权限",width:"30%"},{footer:o(()=>[n("span",mt,[t(g,{onClick:e[24]||(e[24]=a=>z.value=!1)},{default:o(()=>[d("取消")]),_:1}),t(g,{type:"primary",style:{"background-color":"#1b9aee !important"},onClick:e[25]||(e[25]=a=>be())},{default:o(()=>[d(" 确认 ")]),_:1})])]),default:o(()=>[it,n("div",dt,[t(Ie,{modelValue:R.value,"onUpdate:modelValue":e[23]||(e[23]=a=>R.value=a),style:{"justify-content":"center"}},{default:o(()=>[t(ge,{label:"1",border:""},{default:o(()=>[d("管理员")]),_:1}),t(ge,{label:"2",border:""},{default:o(()=>[d("普通成员")]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"]),t(K,{modelValue:N.value,"onUpdate:modelValue":e[30]||(e[30]=a=>N.value=a),title:"您的邀请链接"},{footer:o(()=>[n("span",gt,[t(g,{type:"primary",style:{"background-color":"#1b9aee !important"},onClick:e[29]||(e[29]=a=>N.value=!1)},{default:o(()=>[d("返回")]),_:1})])]),default:o(()=>[n("div",ct,[pt,je(n("input",{"onUpdate:modelValue":e[27]||(e[27]=a=>w.value=a),class:"invite-link-input",disabled:""},null,512),[[Oe,w.value]]),t(_,{class:"box-item",effect:"dark",content:"复制链接",placement:"top"},{default:o(()=>[t(v,{class:"invite-link-icon",onClick:e[28]||(e[28]=a=>ye())},{default:o(()=>[t(p(Je))]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}});const wt=Ee(vt,[["__scopeId","data-v-1b988f2a"]]);export{wt as default};
