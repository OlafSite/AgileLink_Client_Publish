import{_ as xe}from"./111-95b7bfc1.js";import{q as Ce,r as m,b as Se,u as Ue,s as Ve,d as Ne,e as d,o as M,f as J,g as a,h as n,j as o,x as W,t as C,y as p,z as Me,A as $e,B as Ie,C as F,D as Le,G as Je,i as w,H as Oe,I as De,J as Ae,K as Te,L as Ge,F as qe,m as $,E as h,p as ze,n as Be,_ as je}from"./index-4d5b55f1.js";const Ee=""+new URL("logo-1a0a53de.png",import.meta.url).href,v=L=>(ze("data-v-91bce918"),L=L(),Be(),L),We={class:"head-content"},Fe=["src"],Re={class:"show-content"},Pe={class:"show-content-top"},Qe=["src"],He={class:"show-content-center"},Ke={class:"show-group"},Xe=v(()=>o("hr",{style:{color:"#311c4b"}},null,-1)),Ye={class:"show-content-bottom"},Ze=v(()=>o("div",{class:"show-team-title"},[o("span",null,"团队")],-1)),et={class:"show-team-item-font"},tt=v(()=>o("img",{class:"show-team-item-img",src:xe,alt:""},null,-1)),at={class:"show-team-item-content"},st={class:"show-team-item-content-text"},nt={class:"show-team-item-content-enter"},ot=v(()=>o("span",{class:"show-content-center-text"},"切换",-1)),it=v(()=>o("img",{src:Ee,class:"logo"},null,-1)),lt=v(()=>o("div",{style:{position:"relative",right:"2px"}},"项目管理",-1)),rt=v(()=>o("div",{style:{position:"relative",right:"2px"}},"成员管理",-1)),ct=v(()=>o("div",{style:{"margin-left":"10px"}},"消息",-1)),dt={class:"description-title"},mt=["src"],ut=v(()=>o("span",{class:"description-title-text"},"个人信息简介",-1)),_t={class:"description-extra"},pt={class:"cell-item"},vt={class:"description-content"},gt={class:"cell-item"},ft={class:"description-content"},ht={class:"cell-item"},wt={class:"description-content"},yt={class:"cell-item"},bt={class:"description-content"},kt={class:"cell-item"},xt={key:0,class:"user-description-content indent"},Ct={key:1,class:"user-description-empty"},St={class:"update-content"},Ut={class:"left"},Vt=["src"],Nt={class:"dialog-footer"},I="marginRight: 8px",R="#/api/v1/team_manage/user/upload_avatar",Mt=Ce({__name:"main",setup(L){const g=m(null),y=m(null),q=Se(),s=Ue(),b=m(0),O=m(!0),P=m(!1),Q=m(!1);async function H(){s.commit("initGroup"),await z(),await K(),await X(),await ee(),await Z(),O.value=!1}Ve(()=>{H(),console.log("img"+u().user_avatar),console.log(u()),console.log("image"+f)});function u(){return s.getters.getUserinfo}function z(){$({url:"#/api/v1/team_manage/view_member_info",method:"post",data:JSON.stringify({token:u().token,team_id:u().currentTeam.id})}).then(i=>{s.commit("initGroup");let t=i.data.data;s.commit("initGroup");for(let e of t)s.commit("addMember",{id:e.user_id,nickname:e.nickname,status:e.status,name:e.name,username:e.username,email:e.email,avatar:e.avatar})}).catch(i=>{console.log(i)})}function K(){$({url:"#/api/v1/public_chat/login_get_messages",method:"post",data:JSON.stringify({token:u().token})}).then(i=>{s.commit("cleanChat"),Y();let t=i.data.data.team_list,e=i.data.data.private_chat_list,_=i.data.data.group_chat_list;for(let l of t)l.team_id===u().currentTeam.id&&s.commit("updateChat",{id:0,name:l.team_name,message_num:l.message_num,newMessage:JSON.parse(JSON.stringify(l.last_message))});for(let l of e)s.commit("updateChat",{id:l.people_id,name:l.people_name,message_num:l.message_num,newMessage:JSON.parse(JSON.stringify(l.last_message))});for(let l of _)s.commit("initChat",{id:-1*l.group_id,name:l.group_name,message_num:l.message_num,newMessage:l.last_message!==null?JSON.parse(JSON.stringify(l.last_message)):{content:""}});console.log(s.getters.getChats)}).catch(i=>{console.log(i)})}function X(){$({url:"#/api/v1/notice_center/get_unread_notice",method:"post",data:JSON.stringify({token:u().token})}).then(i=>{console.log(i.data.data),s.commit("changeNoticeList",i.data.data.unread_notice_list)}).catch(i=>{console.log(i)})}function D(i){for(let t of s.getters.getChats)if(t.id===i)return t}function Y(){s.commit("initChat",{id:0,name:u().currentTeam.name,message_num:0,newMessage:{content:""}});for(let i of s.getters.getMembers)i.id!==u().user_id&&s.commit("initChat",{id:i.id,name:i.name,message_num:0,newMessage:{content:""}})}function Z(){const i=`?token=${u().token}`;y.value=new WebSocket(`ws://82.156.154.154:4880/api/v1/ws/notice/${i}`),y.value.onopen=function(t){h.success("通知网络就绪"),Q.value=!0,s.commit("saveNoticeSocket",y)},y.value.onmessage=function(t){h.success(JSON.parse(t.data).content),s.commit("addNotice",JSON.parse(t.data))},g.value.onclose=function(t){h.warning("网络刷新"),y.value=new WebSocket(`ws://82.156.154.154:4880/api/v1/ws/notice/${i}`),s.commit("saveSocket",y)}}function ee(){const i=`?token=${u().token}`;g.value=new WebSocket(`ws://82.156.154.154:4880/api/v1/ws/chat/${i}`),g.value.onopen=function(t){h.success("消息网络就绪"),s.commit("saveSocket",g),P.value=!0},g.value.onmessage=function(t){let e=JSON.parse(t.data);console.log(e);let _;if(e.type===1?_=0:e.type===2?_=e.receive_user_id:_=e.receive_group_id*-1,e.sender_id===u().user_id){let l=D(_);s.commit("updateChat",{id:_,name:l.name,message_num:1,newMessage:{id:e.id,type:e.type,sender_id:e.sender_id,sender_name:e.sender_name,sender_username:e.sender_username,sender_avatar:e.sender_avatar,receive_team_id:e.receive_team_id,receive_team_name:e.receive_team_name,receive_user_id:e.receive_user_id,receive_user_name:e.receive_user_name,receive_user_avatar:e.receive_user_avatar,receive_group_id:e.receive_group_id,receive_group_name:e.receive_group_name,content:e.content,file_content:e.file_content,message_source:e.message_source,time:e.time}})}else if(h.info("收到新的消息！"),e.sender_id===s.state.Chat.currentChatID&&e.type===2||e.type===1&&s.state.Chat.currentChatID===0||e.type===3&&s.state.Chat.currentChatID===-1*e.receive_group_id){let l=D(_);s.commit("updateChat",{id:_,name:l.name,message_num:1,newMessage:{id:e.id,type:e.type,sender_id:e.sender_id,sender_name:e.sender_name,sender_username:e.sender_username,sender_avatar:e.sender_avatar,receive_team_id:e.receive_team_id,receive_team_name:e.receive_team_name,receive_user_id:e.receive_user_id,receive_user_name:e.receive_user_name,receive_user_avatar:e.receive_user_avatar,receive_group_id:e.receive_group_id,receive_group_name:e.receive_group_name,content:e.content,file_content:e.file_content,message_source:e.message_source,time:e.time}})}else{let l=D(_);s.commit("updateChat",{id:_,name:l.name,message_num:l.message_num+1,newMessage:{id:e.id,type:e.type,sender_id:e.sender_id,sender_name:e.sender_name,sender_username:e.sender_username,sender_avatar:e.sender_avatar,receive_team_id:e.receive_team_id,receive_team_name:e.receive_team_name,receive_user_id:e.receive_user_id,receive_user_name:e.receive_user_name,receive_user_avatar:e.receive_user_avatar,receive_group_id:e.receive_group_id,receive_group_name:e.receive_group_name,content:e.content,file_content:e.file_content,message_source:e.message_source,time:e.time}})}},g.value.onclose=function(t){h.warning("网络波动"),g.value=new WebSocket(`ws://82.156.154.154:4880/api/v1/ws/chat/${i}`),s.commit("saveSocket",g)}}function te(){s.commit("changeCurrent",0)}function ae(){console.log("切换团队"),q.push("/team")}function se(){console.log("退出登录"),s.commit("initC"),s.commit("initU"),s.commit("initD"),s.commit("initG"),q.push("/login")}const ne=m(u().currentTeam.name),k=m(!1),S=m(!1),oe={nickname:[{required:!0,message:"昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"账号密码不能为空",trigger:"blur"}]},r=Ne({avatar:s.state.User.user_avatar,name:s.state.User.user_username,nickname:s.state.User.user_name,email:s.state.User.user_email,description:s.state.User.user_description,id:s.state.User.user_id});function ie(){S.value=!0,k.value=!1}function le(){const i=new FormData;i.append("token",u().token),i.append("avatar",A.value),$.post(R,i).then(t=>{ce(t.data)}).catch(t=>{de(t)}),$({url:"#/api/v1/team_manage/user/change_info",method:"post",data:JSON.stringify({token:u().token,username:r.nickname,name:r.name,introduction:r.description})}).then(t=>{t.data.errno===1003?(h.warning("该用户名已被使用，无法更改！"),r.nickname=s.state.User.user_name):(s.commit("editUser",r),z(),h({message:"个人信息修改成功",type:"success"}))}).catch(t=>{console.log(t)}),S.value=!1,k.value=!0}m("../../assets/headpot/111.jpg");const f=m(s.state.User.user_avatar),A=m(null),U=m(!0),re=i=>{console.log(123),console.log(i),A.value=i.raw,console.log(A.value)},ce=i=>{console.log(1),console.log(i),f.value=i.data.avatar,s.commit("updateAvatar",f)},de=i=>{console.log(i)};function B(){S.value=!1,k.value=!0,r.avatar=s.state.User.user_avatar,r.name=s.state.User.user_username,r.nickname=s.state.User.user_name,r.email=s.state.User.user_email,r.description=s.state.User.user_description,r.id=s.state.User.user_id,f.value=s.state.User.user_avatar}const me=m([]);m([]).value.push({name:"小学期"},{name:"软工一"}),me.value.push({name:"谢秉书",messageList:[]},{name:"吴骁",messageList:[]},{name:"周霄",messageList:[]});const ue={date:"2016-05-02",name:"Tom",address:"No. 189, Grove St, Los Angeles"};return m(Array.from({length:20}).fill(ue)),(i,t)=>{const e=d("el-popover"),_=d("el-header"),l=d("el-icon"),T=d("el-menu-item"),_e=d("el-menu"),pe=d("el-scrollbar"),ve=d("el-aside"),ge=d("router-view"),fe=d("el-main"),j=d("el-container"),G=d("el-button"),he=d("el-tooltip"),V=d("el-descriptions-item"),we=d("el-empty"),ye=d("el-descriptions"),E=d("el-dialog"),be=d("el-upload"),x=d("el-form-item"),N=d("el-input"),ke=d("el-form");return M(),J(qe,null,[a(j,{class:"layout-container-demo",style:{height:"100vh"}},{default:n(()=>[a(_,{style:{"text-indent":"0","font-size":"30px",color:"white",height:"8vh",padding:"0px",position:"relative","min-height":"70px","min-width":"875px"}},{default:n(()=>[o("div",We,[a(e,{width:300,"popper-style":"box-shadow: rgb(14 18 22 / 35%) 0px 10px 38px -10px, rgb(14 18 22 / 20%) 0px 10px 20px -15px; padding: 20px;",trigger:"click"},{reference:n(()=>[o("img",{src:f.value,class:"head-pot",alt:""},null,8,Fe)]),default:n(()=>[o("div",Re,[o("div",Pe,[o("img",{style:{"margin-bottom":"8px"},src:f.value,class:"show-img",alt:""},null,8,Qe)]),o("div",He,[o("ul",Ke,[o("li",{onMouseover:t[0]||(t[0]=c=>b.value=1),onMouseleave:t[1]||(t[1]=c=>b.value=0),onClick:t[2]||(t[2]=c=>k.value=!0),class:"show-item",style:W(b.value==1?"background-color: #f2f5f7":"")},"个人信息",36),o("li",{onMouseover:t[3]||(t[3]=c=>b.value=2),onMouseleave:t[4]||(t[4]=c=>b.value=0),onClick:t[5]||(t[5]=c=>se()),class:"show-item",style:W(b.value==2?"background-color: #f2f5f7":"")},"退出登录",36)])]),Xe,o("div",Ye,[Ze,o("div",{class:"show-team-content",onClick:t[6]||(t[6]=c=>ae())},[o("div",et,[tt,o("div",at,[o("span",st,C(ne.value),1)])]),o("div",nt,[ot,a(p(Me),{style:{width:"1em",height:"1em","margin-right":"8px"}})])])])])]),_:1}),it])]),_:1}),a(j,{height:"92vh"},{default:n(()=>[a(ve,{style:{width:"4.14%","min-width":"71px"}},{default:n(()=>[a(pe,null,{default:n(()=>[a(_e,{"default-active":"/main/manage",router:"",style:{"--el-menu-base-level-padding":"0px !important"}},{default:n(()=>[a(T,{index:"/main/manage"},{title:n(()=>[o("div",null,[o("div",null,[a(l,{style:{position:"relative",left:"10px"}},{default:n(()=>[a(p($e))]),_:1})]),lt])]),_:1}),a(T,{index:"/main/members",disabled:O.value},{title:n(()=>[o("div",null,[o("div",null,[a(l,{style:{position:"relative",left:"10px"}},{default:n(()=>[a(p(Ie))]),_:1})]),rt])]),_:1},8,["disabled"]),a(T,{index:"/main/message",disabled:O.value,onClick:te},{title:n(()=>[o("div",null,[o("div",null,[a(l,{style:{position:"relative",left:"10px"}},{default:n(()=>[a(p(F))]),_:1})]),ct])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(fe,{style:{"min-width":"875px"}},{default:n(()=>[a(ge)]),_:1})]),_:1})]),_:1}),a(E,{modelValue:k.value,"onUpdate:modelValue":t[8]||(t[8]=c=>k.value=c),title:"AgileLink",width:"50%"},{default:n(()=>[a(ye,{class:"margin-top",column:2,size:"large",border:""},{title:n(()=>[o("div",dt,[o("img",{src:f.value,class:"head-img",alt:""},null,8,mt),ut])]),extra:n(()=>[o("div",_t,[a(he,{class:"box-item",effect:"dark",content:"编辑个人信息",placement:"bottom"},{default:n(()=>[a(G,{style:{margin:"5px","background-color":"#1b9aee !important"},type:"primary",icon:p(Le),size:"large",onClick:t[7]||(t[7]=c=>ie()),circle:""},null,8,["icon"])]),_:1})])]),default:n(()=>[a(V,null,{label:n(()=>[o("div",pt,[a(l,{style:I},{default:n(()=>[a(p(Je))]),_:1}),w(" 用户名 ")])]),default:n(()=>[o("div",vt,C(r.nickname),1)]),_:1}),a(V,null,{label:n(()=>[o("div",gt,[a(l,{style:I},{default:n(()=>[a(p(Oe))]),_:1}),w(" 姓名 ")])]),default:n(()=>[o("div",ft,C(r.name),1)]),_:1}),a(V,null,{label:n(()=>[o("div",ht,[a(l,{style:I},{default:n(()=>[a(p(De))]),_:1}),w(" ID ")])]),default:n(()=>[o("div",wt,C(r.id),1)]),_:1}),a(V,null,{label:n(()=>[o("div",yt,[a(l,{style:I},{default:n(()=>[a(p(F))]),_:1}),w(" 邮箱 ")])]),default:n(()=>[o("div",bt,C(r.email),1)]),_:1}),a(V,null,{label:n(()=>[o("div",kt,[a(l,{style:I},{default:n(()=>[a(p(Ae))]),_:1}),w(" 个人简介 ")])]),default:n(()=>[r.description?(M(),J("div",xt,C(r.description),1)):(M(),J("div",Ct,[a(we,{description:"这个人很懒，什么都没有留下QAQ"})]))]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(E,{title:"修改个人信息",modelValue:S.value,"onUpdate:modelValue":t[20]||(t[20]=c=>S.value=c),width:"40%","before-close":B},{footer:n(()=>[o("span",Nt,[a(G,{onClick:t[18]||(t[18]=c=>B())},{default:n(()=>[w("取消")]),_:1}),a(G,{type:"primary",style:{"background-color":"#1b9aee !important"},onClick:t[19]||(t[19]=c=>le())},{default:n(()=>[w(" 保存 ")]),_:1})])]),default:n(()=>[a(ke,{model:r,rules:oe,ref:"updateInfo","label-width":"150px"},{default:n(()=>[o("div",St,[o("div",Ut,[a(x,{label:"头像",prop:"head-pot"},{default:n(()=>[a(be,{ref:"upLoads",class:"avatar-uploader",limit:1,action:R,"auto-upload":!1,"on-change":re,"show-file-list":!0},{default:n(()=>[U.value?(M(),J("img",{key:0,slot:"trigger",src:f.value,class:"avatar",onMouseover:t[9]||(t[9]=c=>U.value=!1),onMouseleave:t[10]||(t[10]=c=>U.value=!0)},null,40,Vt)):(M(),Te(l,{key:1,slot:"trigger",class:"avatar-uploader-icon",onMouseleave:t[11]||(t[11]=c=>U.value=!0),onMouseover:t[12]||(t[12]=c=>U.value=!1)},{default:n(()=>[a(p(Ge))]),_:1}))]),_:1},512)]),_:1}),a(x,{label:"用户ID",prop:"id"},{default:n(()=>[a(N,{modelValue:r.id,"onUpdate:modelValue":t[13]||(t[13]=c=>r.id=c),disabled:""},null,8,["modelValue"])]),_:1}),a(x,{label:"用户名",prop:"nickname"},{default:n(()=>[a(N,{modelValue:r.nickname,"onUpdate:modelValue":t[14]||(t[14]=c=>r.nickname=c)},null,8,["modelValue"])]),_:1}),a(x,{label:"姓名",prop:"name"},{default:n(()=>[a(N,{modelValue:r.name,"onUpdate:modelValue":t[15]||(t[15]=c=>r.name=c)},null,8,["modelValue"])]),_:1}),a(x,{label:"邮箱",prop:"email"},{default:n(()=>[a(N,{modelValue:r.email,"onUpdate:modelValue":t[16]||(t[16]=c=>r.email=c),disabled:""},null,8,["modelValue"])]),_:1}),a(x,{label:"简介",prop:"description"},{default:n(()=>[a(N,{modelValue:r.description,"onUpdate:modelValue":t[17]||(t[17]=c=>r.description=c),rows:4,type:"textarea",placeholder:"请输入您的个人简介"},null,8,["modelValue"])]),_:1})])])]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});const Jt=je(Mt,[["__scopeId","data-v-91bce918"]]);export{Jt as default};
