import{P as ye,S as W,k as tt,a as ot,T as V,F as D,b as J,c as Pe,D as ge,d as je,N as nt,e as lt,f as de,m as ue,g as rt,h as st,i as it,j as ct,u as at,l as Se,n as dt,E as ut,H as ft,o as pt,p as ht,q as gt,C as mt,r as bt,s as wt,B as Ct,t as vt,M as yt,v as xt}from"./index-973c9190.js";import{u as Ve,r as L,w as ee,E as Y,s as St,ab as _t,y,o as O,f as P,g as N,h as I,j as m,Z as U,Q as _e,F as te,i as X,t as q,_ as At,b as kt,e as Ae,ac as Rt,W as ne,O as ke,m as pe,p as Mt,n as Tt}from"./index-4d5b55f1.js";import{F as Nt}from"./FileSaver.min-eca27638.js";var me,be;if(typeof WeakMap<"u"){let e=new WeakMap;me=t=>e.get(t),be=(t,n)=>(e.set(t,n),n)}else{const e=[];let n=0;me=o=>{for(let l=0;l<e.length;l+=2)if(e[l]==o)return e[l+1]},be=(o,l)=>(n==10&&(n=0),e[n++]=o,e[n++]=l)}var _=class{constructor(e,t,n,o){this.width=e,this.height=t,this.map=n,this.problems=o}findCell(e){for(let t=0;t<this.map.length;t++){const n=this.map[t];if(n!=e)continue;const o=t%this.width,l=t/this.width|0;let r=o+1,s=l+1;for(let a=1;r<this.width&&this.map[t+a]==n;a++)r++;for(let a=1;s<this.height&&this.map[t+this.width*a]==n;a++)s++;return{left:o,top:l,right:r,bottom:s}}throw new RangeError(`No cell with offset ${e} found`)}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError(`No cell with offset ${e} found`)}nextCell(e,t,n){const{left:o,right:l,top:r,bottom:s}=this.findCell(e);return t=="horiz"?(n<0?o==0:l==this.width)?null:this.map[r*this.width+(n<0?o-1:l)]:(n<0?r==0:s==this.height)?null:this.map[o+this.width*(n<0?r-1:s)]}rectBetween(e,t){const{left:n,right:o,top:l,bottom:r}=this.findCell(e),{left:s,right:a,top:i,bottom:c}=this.findCell(t);return{left:Math.min(n,s),top:Math.min(l,i),right:Math.max(o,a),bottom:Math.max(r,c)}}cellsInRect(e){const t=[],n={};for(let o=e.top;o<e.bottom;o++)for(let l=e.left;l<e.right;l++){const r=o*this.width+l,s=this.map[r];n[s]||(n[s]=!0,!(l==e.left&&l&&this.map[r-1]==s||o==e.top&&o&&this.map[r-this.width]==s)&&t.push(s))}return t}positionAt(e,t,n){for(let o=0,l=0;;o++){const r=l+n.child(o).nodeSize;if(o==e){let s=t+e*this.width;const a=(e+1)*this.width;for(;s<a&&this.map[s]<l;)s++;return s==a?r-1:this.map[s]}l=r}}static get(e){return me(e)||be(e,Et(e))}};function Et(e){if(e.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+e.type.name);const t=zt(e),n=e.childCount,o=[];let l=0,r=null;const s=[];for(let c=0,d=t*n;c<d;c++)o[c]=0;for(let c=0,d=0;c<n;c++){const u=e.child(c);d++;for(let h=0;;h++){for(;l<o.length&&o[l]!=0;)l++;if(h==u.childCount)break;const w=u.child(h),{colspan:b,rowspan:S,colwidth:g}=w.attrs;for(let k=0;k<S;k++){if(k+c>=n){(r||(r=[])).push({type:"overlong_rowspan",pos:d,n:S-k});break}const T=l+k*t;for(let A=0;A<b;A++){o[T+A]==0?o[T+A]=d:(r||(r=[])).push({type:"collision",row:c,pos:d,n:b-A});const H=g&&g[A];if(H){const F=(T+A)%t*2,x=s[F];x==null||x!=H&&s[F+1]==1?(s[F]=H,s[F+1]=1):x==H&&s[F+1]++}}}l+=b,d+=w.nodeSize}const f=(c+1)*t;let p=0;for(;l<f;)o[l++]==0&&p++;p&&(r||(r=[])).push({type:"missing",row:c,n:p}),d++}const a=new _(t,n,o,r);let i=!1;for(let c=0;!i&&c<s.length;c+=2)s[c]!=null&&s[c+1]<n&&(i=!0);return i&&Ht(a,s,e),a}function zt(e){let t=-1,n=!1;for(let o=0;o<e.childCount;o++){const l=e.child(o);let r=0;if(n)for(let s=0;s<o;s++){const a=e.child(s);for(let i=0;i<a.childCount;i++){const c=a.child(i);s+c.attrs.rowspan>o&&(r+=c.attrs.colspan)}}for(let s=0;s<l.childCount;s++){const a=l.child(s);r+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}t==-1?t=r:t!=r&&(t=Math.max(t,r))}return t}function Ht(e,t,n){e.problems||(e.problems=[]);const o={};for(let l=0;l<e.map.length;l++){const r=e.map[l];if(o[r])continue;o[r]=!0;const s=n.nodeAt(r);if(!s)throw new RangeError(`No cell with offset ${r} found`);let a=null;const i=s.attrs;for(let c=0;c<i.colspan;c++){const d=(l+c)%e.width,u=t[d*2];u!=null&&(!i.colwidth||i.colwidth[c]!=u)&&((a||(a=Lt(i)))[c]=u)}a&&e.problems.unshift({type:"colwidth mismatch",pos:r,colwidth:a})}}function Lt(e){if(e.colwidth)return e.colwidth.slice();const t=[];for(let n=0;n<e.colspan;n++)t.push(0);return t}function M(e){let t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(const n in e.nodes){const o=e.nodes[n],l=o.spec.tableRole;l&&(t[l]=o)}}return t}var j=new ye("selectingCells");function Q(e){for(let t=e.depth-1;t>0;t--)if(e.node(t).type.spec.tableRole=="row")return e.node(0).resolve(e.before(t+1));return null}function $t(e){for(let t=e.depth;t>0;t--){const n=e.node(t).type.spec.tableRole;if(n==="cell"||n==="header_cell")return e.node(t)}return null}function $(e){const t=e.selection.$head;for(let n=t.depth;n>0;n--)if(t.node(n).type.spec.tableRole=="row")return!0;return!1}function fe(e){const t=e.selection;if("$anchorCell"in t&&t.$anchorCell)return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell;if("node"in t&&t.node&&t.node.type.spec.tableRole=="cell")return t.$anchor;const n=Q(t.$head)||Dt(t.$head);if(n)return n;throw new RangeError(`No cell found around position ${t.head}`)}function Dt(e){for(let t=e.nodeAfter,n=e.pos;t;t=t.firstChild,n++){const o=t.type.spec.tableRole;if(o=="cell"||o=="header_cell")return e.doc.resolve(n)}for(let t=e.nodeBefore,n=e.pos;t;t=t.lastChild,n--){const o=t.type.spec.tableRole;if(o=="cell"||o=="header_cell")return e.doc.resolve(n-t.nodeSize)}}function we(e){return e.parent.type.spec.tableRole=="row"&&!!e.nodeAfter}function Bt(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function xe(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function Je(e,t,n){const o=e.node(-1),l=_.get(o),r=e.start(-1),s=l.nextCell(e.pos-r,t,n);return s==null?null:e.node(0).resolve(r+s)}function G(e,t,n=1){const o={...e,colspan:e.colspan-n};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(t,n),o.colwidth.some(l=>l>0)||(o.colwidth=null)),o}function Ke(e,t,n=1){const o={...e,colspan:e.colspan+n};if(o.colwidth){o.colwidth=o.colwidth.slice();for(let l=0;l<n;l++)o.colwidth.splice(t,0,0)}return o}function Ft(e,t,n){const o=M(t.type.schema).header_cell;for(let l=0;l<e.height;l++)if(t.nodeAt(e.map[n+l*e.width]).type!=o)return!1;return!0}var C=class extends W{constructor(e,t=e){const n=e.node(-1),o=_.get(n),l=e.start(-1),r=o.rectBetween(e.pos-l,t.pos-l),s=e.node(0),a=o.cellsInRect(r).filter(c=>c!=t.pos-l);a.unshift(t.pos-l);const i=a.map(c=>{const d=n.nodeAt(c);if(!d)throw RangeError(`No cell with offset ${c} found`);const u=l+c+1;return new ot(s.resolve(u),s.resolve(u+d.content.size))});super(i[0].$from,i[0].$to,i),this.$anchorCell=e,this.$headCell=t}map(e,t){const n=e.resolve(t.map(this.$anchorCell.pos)),o=e.resolve(t.map(this.$headCell.pos));if(we(n)&&we(o)&&xe(n,o)){const l=this.$anchorCell.node(-1)!=n.node(-1);return l&&this.isRowSelection()?C.rowSelection(n,o):l&&this.isColSelection()?C.colSelection(n,o):new C(n,o)}return V.between(n,o)}content(){const e=this.$anchorCell.node(-1),t=_.get(e),n=this.$anchorCell.start(-1),o=t.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),l={},r=[];for(let a=o.top;a<o.bottom;a++){const i=[];for(let c=a*t.width+o.left,d=o.left;d<o.right;d++,c++){const u=t.map[c];if(l[u])continue;l[u]=!0;const f=t.findCell(u);let p=e.nodeAt(u);if(!p)throw RangeError(`No cell with offset ${u} found`);const h=o.left-f.left,w=f.right-o.right;if(h>0||w>0){let b=p.attrs;if(h>0&&(b=G(b,0,h)),w>0&&(b=G(b,b.colspan-w,w)),f.left<o.left){if(p=p.type.createAndFill(b),!p)throw RangeError(`Could not create cell with attrs ${JSON.stringify(b)}`)}else p=p.type.create(b,p.content)}if(f.top<o.top||f.bottom>o.bottom){const b={...p.attrs,rowspan:Math.min(f.bottom,o.bottom)-Math.max(f.top,o.top)};f.top<o.top?p=p.type.createAndFill(b):p=p.type.create(b,p.content)}i.push(p)}r.push(e.child(a).copy(D.from(i)))}const s=this.isColSelection()&&this.isRowSelection()?e:r;return new J(D.from(s),1,1)}replace(e,t=J.empty){const n=e.steps.length,o=this.ranges;for(let r=0;r<o.length;r++){const{$from:s,$to:a}=o[r],i=e.mapping.slice(n);e.replace(i.map(s.pos),i.map(a.pos),r?J.empty:t)}const l=W.findFrom(e.doc.resolve(e.mapping.slice(n).map(this.to)),-1);l&&e.setSelection(l)}replaceWith(e,t){this.replace(e,new J(D.from(t),0,0))}forEachCell(e){const t=this.$anchorCell.node(-1),n=_.get(t),o=this.$anchorCell.start(-1),l=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o));for(let r=0;r<l.length;r++)e(t.nodeAt(l[r]),o+l[r])}isColSelection(){const e=this.$anchorCell.index(-1),t=this.$headCell.index(-1);if(Math.min(e,t)>0)return!1;const n=e+this.$anchorCell.nodeAfter.attrs.rowspan,o=t+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,o)==this.$headCell.node(-1).childCount}static colSelection(e,t=e){const n=e.node(-1),o=_.get(n),l=e.start(-1),r=o.findCell(e.pos-l),s=o.findCell(t.pos-l),a=e.node(0);return r.top<=s.top?(r.top>0&&(e=a.resolve(l+o.map[r.left])),s.bottom<o.height&&(t=a.resolve(l+o.map[o.width*(o.height-1)+s.right-1]))):(s.top>0&&(t=a.resolve(l+o.map[s.left])),r.bottom<o.height&&(e=a.resolve(l+o.map[o.width*(o.height-1)+r.right-1]))),new C(e,t)}isRowSelection(){const e=this.$anchorCell.node(-1),t=_.get(e),n=this.$anchorCell.start(-1),o=t.colCount(this.$anchorCell.pos-n),l=t.colCount(this.$headCell.pos-n);if(Math.min(o,l)>0)return!1;const r=o+this.$anchorCell.nodeAfter.attrs.colspan,s=l+this.$headCell.nodeAfter.attrs.colspan;return Math.max(r,s)==t.width}eq(e){return e instanceof C&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,t=e){const n=e.node(-1),o=_.get(n),l=e.start(-1),r=o.findCell(e.pos-l),s=o.findCell(t.pos-l),a=e.node(0);return r.left<=s.left?(r.left>0&&(e=a.resolve(l+o.map[r.top*o.width])),s.right<o.width&&(t=a.resolve(l+o.map[o.width*(s.top+1)-1]))):(s.left>0&&(t=a.resolve(l+o.map[s.top*o.width])),r.right<o.width&&(e=a.resolve(l+o.map[o.width*(r.top+1)-1]))),new C(e,t)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,t){return new C(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){return new C(e.resolve(t),e.resolve(n))}getBookmark(){return new Ue(this.$anchorCell.pos,this.$headCell.pos)}};C.prototype.visible=!1;W.jsonID("cell",C);var Ue=class{constructor(e,t){this.anchor=e,this.head=t}map(e){return new Ue(e.map(this.anchor),e.map(this.head))}resolve(e){const t=e.resolve(this.anchor),n=e.resolve(this.head);return t.parent.type.spec.tableRole=="row"&&n.parent.type.spec.tableRole=="row"&&t.index()<t.parent.childCount&&n.index()<n.parent.childCount&&xe(t,n)?new C(t,n):W.near(n,1)}};function It(e){if(!(e.selection instanceof C))return null;const t=[];return e.selection.forEachCell((n,o)=>{t.push(je.node(o,o+n.nodeSize,{class:"selectedCell"}))}),ge.create(e.doc,t)}function Wt({$from:e,$to:t}){if(e.pos==t.pos||e.pos<e.pos-6)return!1;let n=e.pos,o=t.pos,l=e.depth;for(;l>=0&&!(e.after(l+1)<e.end(l));l--,n++);for(let r=t.depth;r>=0&&!(t.before(r+1)>t.start(r));r--,o--);return n==o&&/row|table/.test(e.node(l).type.spec.tableRole)}function Ot({$from:e,$to:t}){let n,o;for(let l=e.depth;l>0;l--){const r=e.node(l);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){n=r;break}}for(let l=t.depth;l>0;l--){const r=t.node(l);if(r.type.spec.tableRole==="cell"||r.type.spec.tableRole==="header_cell"){o=r;break}}return n!==o&&t.parentOffset===0}function Pt(e,t,n){const o=(t||e).selection,l=(t||e).doc;let r,s;if(o instanceof nt&&(s=o.node.type.spec.tableRole)){if(s=="cell"||s=="header_cell")r=C.create(l,o.from);else if(s=="row"){const a=l.resolve(o.from+1);r=C.rowSelection(a,a)}else if(!n){const a=_.get(o.node),i=o.from+1,c=i+a.map[a.width*a.height-1];r=C.create(l,i+1,c)}}else o instanceof V&&Wt(o)?r=V.create(l,o.from):o instanceof V&&Ot(o)&&(r=V.create(l,o.$from.start(),o.$from.end()));return r&&(t||(t=e.tr)).setSelection(r),t}var jt=new ye("fix-tables");function Xe(e,t,n,o){const l=e.childCount,r=t.childCount;e:for(let s=0,a=0;s<r;s++){const i=t.child(s);for(let c=a,d=Math.min(l,s+3);c<d;c++)if(e.child(c)==i){a=c+1,n+=i.nodeSize;continue e}o(i,n),a<l&&e.child(a).sameMarkup(i)?Xe(e.child(a),i,n+1,o):i.nodesBetween(0,i.content.size,o,n+1),n+=i.nodeSize}}function qe(e,t){let n;const o=(l,r)=>{l.type.spec.tableRole=="table"&&(n=Vt(e,l,r,n))};return t?t.doc!=e.doc&&Xe(t.doc,e.doc,0,o):e.doc.descendants(o),n}function Vt(e,t,n,o){const l=_.get(t);if(!l.problems)return o;o||(o=e.tr);const r=[];for(let i=0;i<l.height;i++)r.push(0);for(let i=0;i<l.problems.length;i++){const c=l.problems[i];if(c.type=="collision"){const d=t.nodeAt(c.pos);if(!d)continue;const u=d.attrs;for(let f=0;f<u.rowspan;f++)r[c.row+f]+=c.n;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,G(u,u.colspan-c.n,c.n))}else if(c.type=="missing")r[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const d=t.nodeAt(c.pos);if(!d)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...d.attrs,rowspan:d.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const d=t.nodeAt(c.pos);if(!d)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...d.attrs,colwidth:c.colwidth})}}let s,a;for(let i=0;i<r.length;i++)r[i]&&(s==null&&(s=i),a=i);for(let i=0,c=n+1;i<l.height;i++){const d=t.child(i),u=c+d.nodeSize,f=r[i];if(f>0){let p="cell";d.firstChild&&(p=d.firstChild.type.spec.tableRole);const h=[];for(let b=0;b<f;b++){const S=M(e.schema)[p].createAndFill();S&&h.push(S)}const w=(i==0||s==i-1)&&a==i?c+1:u-1;o.insert(o.mapping.map(w),h)}c=u}return o.setMeta(jt,{fixTables:!0})}function Jt(e){if(!e.size)return null;let{content:t,openStart:n,openEnd:o}=e;for(;t.childCount==1&&(n>0&&o>0||t.child(0).type.spec.tableRole=="table");)n--,o--,t=t.child(0).content;const l=t.child(0),r=l.type.spec.tableRole,s=l.type.schema,a=[];if(r=="row")for(let i=0;i<t.childCount;i++){let c=t.child(i).content;const d=i?0:Math.max(0,n-1),u=i<t.childCount-1?0:Math.max(0,o-1);(d||u)&&(c=Ce(M(s).row,new J(c,d,u)).content),a.push(c)}else if(r=="cell"||r=="header_cell")a.push(n||o?Ce(M(s).row,new J(t,n,o)).content:t);else return null;return Kt(s,a)}function Kt(e,t){const n=[];for(let l=0;l<t.length;l++){const r=t[l];for(let s=r.childCount-1;s>=0;s--){const{rowspan:a,colspan:i}=r.child(s).attrs;for(let c=l;c<l+a;c++)n[c]=(n[c]||0)+i}}let o=0;for(let l=0;l<n.length;l++)o=Math.max(o,n[l]);for(let l=0;l<n.length;l++)if(l>=t.length&&t.push(D.empty),n[l]<o){const r=M(e).cell.createAndFill(),s=[];for(let a=n[l];a<o;a++)s.push(r);t[l]=t[l].append(D.from(s))}return{height:t.length,width:o,rows:t}}function Ce(e,t){const n=e.createAndFill();return new lt(n).replace(0,n.content.size,t).doc}function Ut({width:e,height:t,rows:n},o,l){if(e!=o){const r=[],s=[];for(let a=0;a<n.length;a++){const i=n[a],c=[];for(let d=r[a]||0,u=0;d<o;u++){let f=i.child(u%i.childCount);d+f.attrs.colspan>o&&(f=f.type.createChecked(G(f.attrs,f.attrs.colspan,d+f.attrs.colspan-o),f.content)),c.push(f),d+=f.attrs.colspan;for(let p=1;p<f.attrs.rowspan;p++)r[a+p]=(r[a+p]||0)+f.attrs.colspan}s.push(D.from(c))}n=s,e=o}if(t!=l){const r=[];for(let s=0,a=0;s<l;s++,a++){const i=[],c=n[a%t];for(let d=0;d<c.childCount;d++){let u=c.child(d);s+u.attrs.rowspan>l&&(u=u.type.create({...u.attrs,rowspan:Math.max(1,l-u.attrs.rowspan)},u.content)),i.push(u)}r.push(D.from(i))}n=r,t=l}return{width:e,height:t,rows:n}}function Xt(e,t,n,o,l,r,s){const a=e.doc.type.schema,i=M(a);let c,d;if(l>t.width)for(let u=0,f=0;u<t.height;u++){const p=n.child(u);f+=p.nodeSize;const h=[];let w;p.lastChild==null||p.lastChild.type==i.cell?w=c||(c=i.cell.createAndFill()):w=d||(d=i.header_cell.createAndFill());for(let b=t.width;b<l;b++)h.push(w);e.insert(e.mapping.slice(s).map(f-1+o),h)}if(r>t.height){const u=[];for(let h=0,w=(t.height-1)*t.width;h<Math.max(t.width,l);h++){const b=h>=t.width?!1:n.nodeAt(t.map[w+h]).type==i.header_cell;u.push(b?d||(d=i.header_cell.createAndFill()):c||(c=i.cell.createAndFill()))}const f=i.row.create(null,D.from(u)),p=[];for(let h=t.height;h<r;h++)p.push(f);e.insert(e.mapping.slice(s).map(o+n.nodeSize-2),p)}return!!(c||d)}function Re(e,t,n,o,l,r,s,a){if(s==0||s==t.height)return!1;let i=!1;for(let c=l;c<r;c++){const d=s*t.width+c,u=t.map[d];if(t.map[d-t.width]==u){i=!0;const f=n.nodeAt(u),{top:p,left:h}=t.findCell(u);e.setNodeMarkup(e.mapping.slice(a).map(u+o),null,{...f.attrs,rowspan:s-p}),e.insert(e.mapping.slice(a).map(t.positionAt(s,h,n)),f.type.createAndFill({...f.attrs,rowspan:p+f.attrs.rowspan-s})),c+=f.attrs.colspan-1}}return i}function Me(e,t,n,o,l,r,s,a){if(s==0||s==t.width)return!1;let i=!1;for(let c=l;c<r;c++){const d=c*t.width+s,u=t.map[d];if(t.map[d-1]==u){i=!0;const f=n.nodeAt(u),p=t.colCount(u),h=e.mapping.slice(a).map(u+o);e.setNodeMarkup(h,null,G(f.attrs,s-p,f.attrs.colspan-(s-p))),e.insert(h+f.nodeSize,f.type.createAndFill(G(f.attrs,0,s-p))),c+=f.attrs.rowspan-1}}return i}function Te(e,t,n,o,l){let r=n?e.doc.nodeAt(n-1):e.doc;if(!r)throw new Error("No table found");let s=_.get(r);const{top:a,left:i}=o,c=i+l.width,d=a+l.height,u=e.tr;let f=0;function p(){if(r=n?u.doc.nodeAt(n-1):u.doc,!r)throw new Error("No table found");s=_.get(r),f=u.mapping.maps.length}Xt(u,s,r,n,c,d,f)&&p(),Re(u,s,r,n,i,c,a,f)&&p(),Re(u,s,r,n,i,c,d,f)&&p(),Me(u,s,r,n,a,d,i,f)&&p(),Me(u,s,r,n,a,d,c,f)&&p();for(let h=a;h<d;h++){const w=s.positionAt(h,i,r),b=s.positionAt(h,c,r);u.replace(u.mapping.slice(f).map(w+n),u.mapping.slice(f).map(b+n),new J(l.rows[h-a],0,0))}p(),u.setSelection(new C(u.doc.resolve(n+s.positionAt(a,i,r)),u.doc.resolve(n+s.positionAt(d-1,c-1,r)))),t(u)}var qt=tt({ArrowLeft:le("horiz",-1),ArrowRight:le("horiz",1),ArrowUp:le("vert",-1),ArrowDown:le("vert",1),"Shift-ArrowLeft":re("horiz",-1),"Shift-ArrowRight":re("horiz",1),"Shift-ArrowUp":re("vert",-1),"Shift-ArrowDown":re("vert",1),Backspace:se,"Mod-Backspace":se,Delete:se,"Mod-Delete":se});function ce(e,t,n){return n.eq(e.selection)?!1:(t&&t(e.tr.setSelection(n).scrollIntoView()),!0)}function le(e,t){return(n,o,l)=>{if(!l)return!1;const r=n.selection;if(r instanceof C)return ce(n,o,W.near(r.$headCell,t));if(e!="horiz"&&!r.empty)return!1;const s=Ge(l,e,t);if(s==null)return!1;if(e=="horiz")return ce(n,o,W.near(n.doc.resolve(r.head+t),t));{const a=n.doc.resolve(s),i=Je(a,e,t);let c;return i?c=W.near(i,1):t<0?c=W.near(n.doc.resolve(a.before(-1)),-1):c=W.near(n.doc.resolve(a.after(-1)),1),ce(n,o,c)}}}function re(e,t){return(n,o,l)=>{if(!l)return!1;const r=n.selection;let s;if(r instanceof C)s=r;else{const i=Ge(l,e,t);if(i==null)return!1;s=new C(n.doc.resolve(i))}const a=Je(s.$headCell,e,t);return a?ce(n,o,new C(s.$anchorCell,a)):!1}}function se(e,t){const n=e.selection;if(!(n instanceof C))return!1;if(t){const o=e.tr,l=M(e.schema).cell.createAndFill().content;n.forEachCell((r,s)=>{r.content.eq(l)||o.replace(o.mapping.map(s+1),o.mapping.map(s+r.nodeSize-1),new J(l,0,0))}),o.docChanged&&t(o)}return!0}function Gt(e,t){const n=e.state.doc,o=Q(n.resolve(t));return o?(e.dispatch(e.state.tr.setSelection(new C(o))),!0):!1}function Yt(e,t,n){if(!$(e.state))return!1;let o=Jt(n);const l=e.state.selection;if(l instanceof C){o||(o={width:1,height:1,rows:[D.from(Ce(M(e.state.schema).cell,n))]});const r=l.$anchorCell.node(-1),s=l.$anchorCell.start(-1),a=_.get(r).rectBetween(l.$anchorCell.pos-s,l.$headCell.pos-s);return o=Ut(o,a.right-a.left,a.bottom-a.top),Te(e.state,e.dispatch,s,a,o),!0}else if(o){const r=fe(e.state),s=r.start(-1);return Te(e.state,e.dispatch,s,_.get(r.node(-1)).findCell(r.pos-s),o),!0}else return!1}function Qt(e,t){var n;if(t.ctrlKey||t.metaKey)return;const o=Ne(e,t.target);let l;if(t.shiftKey&&e.state.selection instanceof C)r(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&o&&(l=Q(e.state.selection.$anchor))!=null&&((n=he(e,t))==null?void 0:n.pos)!=l.pos)r(l,t),t.preventDefault();else if(!o)return;function r(i,c){let d=he(e,c);const u=j.getState(e.state)==null;if(!d||!xe(i,d))if(u)d=i;else return;const f=new C(i,d);if(u||!e.state.selection.eq(f)){const p=e.state.tr.setSelection(f);u&&p.setMeta(j,i.pos),e.dispatch(p)}}function s(){e.root.removeEventListener("mouseup",s),e.root.removeEventListener("dragstart",s),e.root.removeEventListener("mousemove",a),j.getState(e.state)!=null&&e.dispatch(e.state.tr.setMeta(j,-1))}function a(i){const c=i,d=j.getState(e.state);let u;if(d!=null)u=e.state.doc.resolve(d);else if(Ne(e,c.target)!=o&&(u=he(e,t),!u))return s();u&&r(u,c)}e.root.addEventListener("mouseup",s),e.root.addEventListener("dragstart",s),e.root.addEventListener("mousemove",a)}function Ge(e,t,n){if(!(e.state.selection instanceof V))return null;const{$head:o}=e.state.selection;for(let l=o.depth-1;l>=0;l--){const r=o.node(l);if((n<0?o.index(l):o.indexAfter(l))!=(n<0?0:r.childCount))return null;if(r.type.spec.tableRole=="cell"||r.type.spec.tableRole=="header_cell"){const a=o.before(l),i=t=="vert"?n>0?"down":"up":n>0?"right":"left";return e.endOfTextblock(i)?a:null}}return null}function Ne(e,t){for(;t&&t!=e.dom;t=t.parentNode)if(t.nodeName=="TD"||t.nodeName=="TH")return t;return null}function he(e,t){const n=e.posAtCoords({left:t.clientX,top:t.clientY});return n&&n?Q(e.state.doc.resolve(n.pos)):null}var Zt=class{constructor(t,n){this.node=t,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),ve(t,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!=this.node.type?!1:(this.node=t,ve(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return t.type=="attributes"&&(t.target==this.table||this.colgroup.contains(t.target))}};function ve(e,t,n,o,l,r){var s;let a=0,i=!0,c=t.firstChild;const d=e.firstChild;if(d){for(let u=0,f=0;u<d.childCount;u++){const{colspan:p,colwidth:h}=d.child(u).attrs;for(let w=0;w<p;w++,f++){const b=l==f?r:h&&h[w],S=b?b+"px":"";a+=b||o,b||(i=!1),c?(c.style.width!=S&&(c.style.width=S),c=c.nextSibling):t.appendChild(document.createElement("col")).style.width=S}}for(;c;){const u=c.nextSibling;(s=c.parentNode)==null||s.removeChild(c),c=u}i?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}}var z=new ye("tableColumnResizing");function eo({handleWidth:e=5,cellMinWidth:t=25,View:n=Zt,lastColumnResizable:o=!0}={}){const l=new Pe({key:z,state:{init(r,s){return l.spec.props.nodeViews[M(s.schema).table.name]=(a,i)=>new n(a,t,i),new ae(-1,!1)},apply(r,s){return s.apply(r)}},props:{attributes:r=>{const s=z.getState(r);return s&&s.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(r,s)=>{to(r,s,e,t,o)},mouseleave:r=>{oo(r)},mousedown:(r,s)=>{no(r,s,t)}},decorations:r=>{const s=z.getState(r);if(s&&s.activeHandle>-1)return ao(r,s.activeHandle)},nodeViews:{}}});return l}var ae=class{constructor(e,t){this.activeHandle=e,this.dragging=t}apply(e){const t=this,n=e.getMeta(z);if(n&&n.setHandle!=null)return new ae(n.setHandle,!1);if(n&&n.setDragging!==void 0)return new ae(t.activeHandle,n.setDragging);if(t.activeHandle>-1&&e.docChanged){let o=e.mapping.map(t.activeHandle,-1);return we(e.doc.resolve(o))||(o=-1),new ae(o,t.dragging)}return t}};function to(e,t,n,o,l){const r=z.getState(e.state);if(r&&!r.dragging){const s=ro(t.target);let a=-1;if(s){const{left:i,right:c}=s.getBoundingClientRect();t.clientX-i<=n?a=Ee(e,t,"left",n):c-t.clientX<=n&&(a=Ee(e,t,"right",n))}if(a!=r.activeHandle){if(!l&&a!==-1){const i=e.state.doc.resolve(a),c=i.node(-1),d=_.get(c),u=i.start(-1);if(d.colCount(i.pos-u)+i.nodeAfter.attrs.colspan-1==d.width-1)return}Ye(e,a)}}}function oo(e){const t=z.getState(e.state);t&&t.activeHandle>-1&&!t.dragging&&Ye(e,-1)}function no(e,t,n){const o=z.getState(e.state);if(!o||o.activeHandle==-1||o.dragging)return!1;const l=e.state.doc.nodeAt(o.activeHandle),r=lo(e,o.activeHandle,l.attrs);e.dispatch(e.state.tr.setMeta(z,{setDragging:{startX:t.clientX,startWidth:r}}));function s(i){window.removeEventListener("mouseup",s),window.removeEventListener("mousemove",a);const c=z.getState(e.state);c!=null&&c.dragging&&(so(e,c.activeHandle,ze(c.dragging,i,n)),e.dispatch(e.state.tr.setMeta(z,{setDragging:null})))}function a(i){if(!i.which)return s(i);const c=z.getState(e.state);if(c&&c.dragging){const d=ze(c.dragging,i,n);io(e,c.activeHandle,d,n)}}return window.addEventListener("mouseup",s),window.addEventListener("mousemove",a),t.preventDefault(),!0}function lo(e,t,{colspan:n,colwidth:o}){const l=o&&o[o.length-1];if(l)return l;const r=e.domAtPos(t);let a=r.node.childNodes[r.offset].offsetWidth,i=n;if(o)for(let c=0;c<n;c++)o[c]&&(a-=o[c],i--);return a/i}function ro(e){for(;e&&e.nodeName!="TD"&&e.nodeName!="TH";)e=e.classList&&e.classList.contains("ProseMirror")?null:e.parentNode;return e}function Ee(e,t,n,o){const l=n=="right"?-o:o,r=e.posAtCoords({left:t.clientX+l,top:t.clientY});if(!r)return-1;const{pos:s}=r,a=Q(e.state.doc.resolve(s));if(!a)return-1;if(n=="right")return a.pos;const i=_.get(a.node(-1)),c=a.start(-1),d=i.map.indexOf(a.pos-c);return d%i.width==0?-1:c+i.map[d-1]}function ze(e,t,n){const o=t.clientX-e.startX;return Math.max(n,e.startWidth+o)}function Ye(e,t){e.dispatch(e.state.tr.setMeta(z,{setHandle:t}))}function so(e,t,n){const o=e.state.doc.resolve(t),l=o.node(-1),r=_.get(l),s=o.start(-1),a=r.colCount(o.pos-s)+o.nodeAfter.attrs.colspan-1,i=e.state.tr;for(let c=0;c<r.height;c++){const d=c*r.width+a;if(c&&r.map[d]==r.map[d-r.width])continue;const u=r.map[d],f=l.nodeAt(u).attrs,p=f.colspan==1?0:a-r.colCount(u);if(f.colwidth&&f.colwidth[p]==n)continue;const h=f.colwidth?f.colwidth.slice():co(f.colspan);h[p]=n,i.setNodeMarkup(s+u,null,{...f,colwidth:h})}i.docChanged&&e.dispatch(i)}function io(e,t,n,o){const l=e.state.doc.resolve(t),r=l.node(-1),s=l.start(-1),a=_.get(r).colCount(l.pos-s)+l.nodeAfter.attrs.colspan-1;let i=e.domAtPos(l.start(-1)).node;for(;i&&i.nodeName!="TABLE";)i=i.parentNode;i&&ve(r,i.firstChild,i,o,a,n)}function co(e){return Array(e).fill(0)}function ao(e,t){const n=[],o=e.doc.resolve(t),l=o.node(-1);if(!l)return ge.empty;const r=_.get(l),s=o.start(-1),a=r.colCount(o.pos-s)+o.nodeAfter.attrs.colspan;for(let i=0;i<r.height;i++){const c=a+i*r.width-1;if((a==r.width||r.map[c]!=r.map[c+1])&&(i==0||r.map[c]!=r.map[c-r.width])){const d=r.map[c],u=s+d+l.nodeAt(d).nodeSize-1,f=document.createElement("div");f.className="column-resize-handle",n.push(je.widget(u,f))}}return ge.create(e.doc,n)}function B(e){const t=e.selection,n=fe(e),o=n.node(-1),l=n.start(-1),r=_.get(o);return{...t instanceof C?r.rectBetween(t.$anchorCell.pos-l,t.$headCell.pos-l):r.findCell(n.pos-l),tableStart:l,map:r,table:o}}function Qe(e,{map:t,tableStart:n,table:o},l){let r=l>0?-1:0;Ft(t,o,l+r)&&(r=l==0||l==t.width?null:0);for(let s=0;s<t.height;s++){const a=s*t.width+l;if(l>0&&l<t.width&&t.map[a-1]==t.map[a]){const i=t.map[a],c=o.nodeAt(i);e.setNodeMarkup(e.mapping.map(n+i),null,Ke(c.attrs,l-t.colCount(i))),s+=c.attrs.rowspan-1}else{const i=r==null?M(o.type.schema).cell:o.nodeAt(t.map[a+r]).type,c=t.positionAt(s,l,o);e.insert(e.mapping.map(n+c),i.createAndFill())}}return e}function uo(e,t){if(!$(e))return!1;if(t){const n=B(e);t(Qe(e.tr,n,n.left))}return!0}function fo(e,t){if(!$(e))return!1;if(t){const n=B(e);t(Qe(e.tr,n,n.right))}return!0}function po(e,{map:t,table:n,tableStart:o},l){const r=e.mapping.maps.length;for(let s=0;s<t.height;){const a=s*t.width+l,i=t.map[a],c=n.nodeAt(i),d=c.attrs;if(l>0&&t.map[a-1]==i||l<t.width-1&&t.map[a+1]==i)e.setNodeMarkup(e.mapping.slice(r).map(o+i),null,G(d,l-t.colCount(i)));else{const u=e.mapping.slice(r).map(o+i);e.delete(u,u+c.nodeSize)}s+=d.rowspan}}function ho(e,t){if(!$(e))return!1;if(t){const n=B(e),o=e.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let l=n.right-1;po(o,n,l),l!=n.left;l--){const r=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!r)throw RangeError("No table found");n.table=r,n.map=_.get(r)}t(o)}return!0}function go(e,t,n){var o;const l=M(t.type.schema).header_cell;for(let r=0;r<e.width;r++)if(((o=t.nodeAt(e.map[r+n*e.width]))==null?void 0:o.type)!=l)return!1;return!0}function Ze(e,{map:t,tableStart:n,table:o},l){var r;let s=n;for(let c=0;c<l;c++)s+=o.child(c).nodeSize;const a=[];let i=l>0?-1:0;go(t,o,l+i)&&(i=l==0||l==t.height?null:0);for(let c=0,d=t.width*l;c<t.width;c++,d++)if(l>0&&l<t.height&&t.map[d]==t.map[d-t.width]){const u=t.map[d],f=o.nodeAt(u).attrs;e.setNodeMarkup(n+u,null,{...f,rowspan:f.rowspan+1}),c+=f.colspan-1}else{const u=i==null?M(o.type.schema).cell:(r=o.nodeAt(t.map[d+i*t.width]))==null?void 0:r.type,f=u==null?void 0:u.createAndFill();f&&a.push(f)}return e.insert(s,M(o.type.schema).row.create(null,a)),e}function mo(e,t){if(!$(e))return!1;if(t){const n=B(e);t(Ze(e.tr,n,n.top))}return!0}function bo(e,t){if(!$(e))return!1;if(t){const n=B(e);t(Ze(e.tr,n,n.bottom))}return!0}function wo(e,{map:t,table:n,tableStart:o},l){let r=0;for(let i=0;i<l;i++)r+=n.child(i).nodeSize;const s=r+n.child(l).nodeSize,a=e.mapping.maps.length;e.delete(r+o,s+o);for(let i=0,c=l*t.width;i<t.width;i++,c++){const d=t.map[c];if(l>0&&d==t.map[c-t.width]){const u=n.nodeAt(d).attrs;e.setNodeMarkup(e.mapping.slice(a).map(d+o),null,{...u,rowspan:u.rowspan-1}),i+=u.colspan-1}else if(l<t.width&&d==t.map[c+t.width]){const u=n.nodeAt(d),f=u.attrs,p=u.type.create({...f,rowspan:u.attrs.rowspan-1},u.content),h=t.positionAt(l+1,i,n);e.insert(e.mapping.slice(a).map(o+h),p),i+=f.colspan-1}}}function Co(e,t){if(!$(e))return!1;if(t){const n=B(e),o=e.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let l=n.bottom-1;wo(o,n,l),l!=n.top;l--){const r=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!r)throw RangeError("No table found");n.table=r,n.map=_.get(n.table)}t(o)}return!0}function He(e){const t=e.content;return t.childCount==1&&t.child(0).isTextblock&&t.child(0).childCount==0}function vo({width:e,height:t,map:n},o){let l=o.top*e+o.left,r=l,s=(o.bottom-1)*e+o.left,a=l+(o.right-o.left-1);for(let i=o.top;i<o.bottom;i++){if(o.left>0&&n[r]==n[r-1]||o.right<e&&n[a]==n[a+1])return!0;r+=e,a+=e}for(let i=o.left;i<o.right;i++){if(o.top>0&&n[l]==n[l-e]||o.bottom<t&&n[s]==n[s+e])return!0;l++,s++}return!1}function Le(e,t){const n=e.selection;if(!(n instanceof C)||n.$anchorCell.pos==n.$headCell.pos)return!1;const o=B(e),{map:l}=o;if(vo(l,o))return!1;if(t){const r=e.tr,s={};let a=D.empty,i,c;for(let d=o.top;d<o.bottom;d++)for(let u=o.left;u<o.right;u++){const f=l.map[d*l.width+u],p=o.table.nodeAt(f);if(!(s[f]||!p))if(s[f]=!0,i==null)i=f,c=p;else{He(p)||(a=a.append(p.content));const h=r.mapping.map(f+o.tableStart);r.delete(h,h+p.nodeSize)}}if(i==null||c==null)return!0;if(r.setNodeMarkup(i+o.tableStart,null,{...Ke(c.attrs,c.attrs.colspan,o.right-o.left-c.attrs.colspan),rowspan:o.bottom-o.top}),a.size){const d=i+1+c.content.size,u=He(c)?i+1:d;r.replaceWith(u+o.tableStart,d+o.tableStart,a)}r.setSelection(new C(r.doc.resolve(i+o.tableStart))),t(r)}return!0}function $e(e,t){const n=M(e.schema);return yo(({node:o})=>n[o.type.spec.tableRole])(e,t)}function yo(e){return(t,n)=>{var o;const l=t.selection;let r,s;if(l instanceof C){if(l.$anchorCell.pos!=l.$headCell.pos)return!1;r=l.$anchorCell.nodeAfter,s=l.$anchorCell.pos}else{if(r=$t(l.$from),!r)return!1;s=(o=Q(l.$from))==null?void 0:o.pos}if(r==null||s==null||r.attrs.colspan==1&&r.attrs.rowspan==1)return!1;if(n){let a=r.attrs;const i=[],c=a.colwidth;a.rowspan>1&&(a={...a,rowspan:1}),a.colspan>1&&(a={...a,colspan:1});const d=B(t),u=t.tr;for(let p=0;p<d.right-d.left;p++)i.push(c?{...a,colwidth:c&&c[p]?[c[p]]:null}:a);let f;for(let p=d.top;p<d.bottom;p++){let h=d.map.positionAt(p,d.left,d.table);p==d.top&&(h+=r.nodeSize);for(let w=d.left,b=0;w<d.right;w++,b++)w==d.left&&p==d.top||u.insert(f=u.mapping.map(h+d.tableStart,1),e({node:r,row:p,col:w}).createAndFill(i[b]))}u.setNodeMarkup(s,e({node:r,row:d.top,col:d.left}),i[0]),l instanceof C&&u.setSelection(new C(u.doc.resolve(l.$anchorCell.pos),f?u.doc.resolve(f):void 0)),n(u)}return!0}}function xo(e,t){return function(n,o){if(!$(n))return!1;const l=fe(n);if(l.nodeAfter.attrs[e]===t)return!1;if(o){const r=n.tr;n.selection instanceof C?n.selection.forEachCell((s,a)=>{s.attrs[e]!==t&&r.setNodeMarkup(a,null,{...s.attrs,[e]:t})}):r.setNodeMarkup(l.pos,null,{...l.nodeAfter.attrs,[e]:t}),o(r)}return!0}}function So(e){return function(t,n){if(!$(t))return!1;if(n){const o=M(t.schema),l=B(t),r=t.tr,s=l.map.cellsInRect(e=="column"?{left:l.left,top:0,right:l.right,bottom:l.map.height}:e=="row"?{left:0,top:l.top,right:l.map.width,bottom:l.bottom}:l),a=s.map(i=>l.table.nodeAt(i));for(let i=0;i<s.length;i++)a[i].type==o.header_cell&&r.setNodeMarkup(l.tableStart+s[i],o.cell,a[i].attrs);if(r.steps.length==0)for(let i=0;i<s.length;i++)r.setNodeMarkup(l.tableStart+s[i],o.header_cell,a[i].attrs);n(r)}return!0}}function De(e,t,n){const o=t.map.cellsInRect({left:0,top:0,right:e=="row"?t.map.width:1,bottom:e=="column"?t.map.height:1});for(let l=0;l<o.length;l++){const r=t.table.nodeAt(o[l]);if(r&&r.type!==n.header_cell)return!1}return!0}function oe(e,t){return t=t||{useDeprecatedLogic:!1},t.useDeprecatedLogic?So(e):function(n,o){if(!$(n))return!1;if(o){const l=M(n.schema),r=B(n),s=n.tr,a=De("row",r,l),i=De("column",r,l),d=(e==="column"?a:e==="row"?i:!1)?1:0,u=e=="column"?{left:0,top:d,right:1,bottom:r.map.height}:e=="row"?{left:d,top:0,right:r.map.width,bottom:1}:r,f=e=="column"?i?l.cell:l.header_cell:e=="row"?a?l.cell:l.header_cell:l.cell;r.map.cellsInRect(u).forEach(p=>{const h=p+r.tableStart,w=s.doc.nodeAt(h);w&&s.setNodeMarkup(h,f,w.attrs)}),o(s)}return!0}}oe("row",{useDeprecatedLogic:!0});oe("column",{useDeprecatedLogic:!0});var _o=oe("cell",{useDeprecatedLogic:!0});function Ao(e,t){if(t<0){const n=e.nodeBefore;if(n)return e.pos-n.nodeSize;for(let o=e.index(-1)-1,l=e.before();o>=0;o--){const r=e.node(-1).child(o),s=r.lastChild;if(s)return l-1-s.nodeSize;l-=r.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;const n=e.node(-1);for(let o=e.indexAfter(-1),l=e.after();o<n.childCount;o++){const r=n.child(o);if(r.childCount)return l+1;l+=r.nodeSize}}return null}function Be(e){return function(t,n){if(!$(t))return!1;const o=Ao(fe(t),e);if(o==null)return!1;if(n){const l=t.doc.resolve(o);n(t.tr.setSelection(V.between(l,Bt(l))).scrollIntoView())}return!0}}function ko(e,t){const n=e.selection.$anchor;for(let o=n.depth;o>0;o--)if(n.node(o).type.spec.tableRole=="table")return t&&t(e.tr.delete(n.before(o),n.after(o)).scrollIntoView()),!0;return!1}function Ro({allowTableNodeSelection:e=!1}={}){return new Pe({key:j,state:{init(){return null},apply(t,n){const o=t.getMeta(j);if(o!=null)return o==-1?null:o;if(n==null||!t.docChanged)return n;const{deleted:l,pos:r}=t.mapping.mapResult(n);return l?null:r}},props:{decorations:It,handleDOMEvents:{mousedown:Qt},createSelectionBetween(t){return j.getState(t.state)!=null?t.state.selection:null},handleTripleClick:Gt,handleKeyDown:qt,handlePaste:Yt},appendTransaction(t,n,o){return Pt(o,qe(o,n),e)}})}function Fe(e,t,n,o,l,r){let s=0,a=!0,i=t.firstChild;const c=e.firstChild;for(let d=0,u=0;d<c.childCount;d+=1){const{colspan:f,colwidth:p}=c.child(d).attrs;for(let h=0;h<f;h+=1,u+=1){const w=l===u?r:p&&p[h],b=w?`${w}px`:"";s+=w||o,w||(a=!1),i?(i.style.width!==b&&(i.style.width=b),i=i.nextSibling):t.appendChild(document.createElement("col")).style.width=b}}for(;i;){const d=i.nextSibling;i.parentNode.removeChild(i),i=d}a?(n.style.width=`${s}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${s}px`)}class Mo{constructor(t,n){this.node=t,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Fe(t,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,Fe(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return t.type==="attributes"&&(t.target===this.table||this.colgroup.contains(t.target))}}function Ie(e,t){return t?e.createChecked(null,t):e.createAndFill()}function To(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach(n=>{const o=e.nodes[n];o.spec.tableRole&&(t[o.spec.tableRole]=o)}),e.cached.tableNodeTypes=t,t}function No(e,t,n,o,l){const r=To(e),s=[],a=[];for(let c=0;c<n;c+=1){const d=Ie(r.cell,l);if(d&&a.push(d),o){const u=Ie(r.header_cell,l);u&&s.push(u)}}const i=[];for(let c=0;c<t;c+=1)i.push(r.row.createChecked(null,o&&c===0?s:a));return r.table.createChecked(null,i)}function Eo(e){return e instanceof C}const ie=({editor:e})=>{const{selection:t}=e.state;if(!Eo(t))return!1;let n=0;const o=it(t.ranges[0].$from,r=>r.type.name==="table");return o==null||o.node.descendants(r=>{if(r.type.name==="table")return!1;["tableCell","tableHeader"].includes(r.type.name)&&(n+=1)}),n===t.ranges.length?(e.commands.deleteTable(),!0):!1},zo=de.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:Mo,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:e}){return["table",ue(this.options.HTMLAttributes,e),["tbody",0]]},addCommands(){return{insertTable:({rows:e=3,cols:t=3,withHeaderRow:n=!0}={})=>({tr:o,dispatch:l,editor:r})=>{const s=No(r.schema,e,t,n);if(l){const a=o.selection.anchor+1;o.replaceSelectionWith(s).scrollIntoView().setSelection(V.near(o.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:e,dispatch:t})=>uo(e,t),addColumnAfter:()=>({state:e,dispatch:t})=>fo(e,t),deleteColumn:()=>({state:e,dispatch:t})=>ho(e,t),addRowBefore:()=>({state:e,dispatch:t})=>mo(e,t),addRowAfter:()=>({state:e,dispatch:t})=>bo(e,t),deleteRow:()=>({state:e,dispatch:t})=>Co(e,t),deleteTable:()=>({state:e,dispatch:t})=>ko(e,t),mergeCells:()=>({state:e,dispatch:t})=>Le(e,t),splitCell:()=>({state:e,dispatch:t})=>$e(e,t),toggleHeaderColumn:()=>({state:e,dispatch:t})=>oe("column")(e,t),toggleHeaderRow:()=>({state:e,dispatch:t})=>oe("row")(e,t),toggleHeaderCell:()=>({state:e,dispatch:t})=>_o(e,t),mergeOrSplit:()=>({state:e,dispatch:t})=>Le(e,t)?!0:$e(e,t),setCellAttribute:(e,t)=>({state:n,dispatch:o})=>xo(e,t)(n,o),goToNextCell:()=>({state:e,dispatch:t})=>Be(1)(e,t),goToPreviousCell:()=>({state:e,dispatch:t})=>Be(-1)(e,t),fixTables:()=>({state:e,dispatch:t})=>(t&&qe(e),!0),setCellSelection:e=>({tr:t,dispatch:n})=>{if(n){const o=C.create(t.doc,e.anchorCell,e.headCell);t.setSelection(o)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:ie,"Mod-Backspace":ie,Delete:ie,"Mod-Delete":ie}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[eo({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Ro({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(e){const t={name:e.name,options:e.options,storage:e.storage};return{tableRole:rt(st(e,"tableRole",t))}}}),Ho=de.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?[parseInt(t,10)]:null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:e}){return["td",ue(this.options.HTMLAttributes,e),0]}}),We=de.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?[parseInt(t,10)]:null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:e}){return["th",ue(this.options.HTMLAttributes,e),0]}}),Oe=de.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:e}){return["tr",ue(this.options.HTMLAttributes,e),0]}});const Lo={key:0,class:"editor"},$o={key:0},Do={class:"editor__footer"},Bo={class:"editor__name"},Fo={__name:"test",setup(e){const t=Ve(),n=L(null),o=L(null),l=x=>x[Math.floor(Math.random()*x.length)];function r(){return t.getters.getUserinfo}function s(){n.value.send(JSON.stringify({text:g.value.getHTML(),force:1})),Y.success("保存成功")}function a(){const x=`?token=${r().token}&doc_id=${c().document_id}`;n.value=new WebSocket(`ws://82.156.154.154:4880/api/v1/ws/doc/${x}`),n.value.onopen=function(v){Y.success("网络就绪"),o.value=setInterval(()=>{k.value!==g.value.getHTML()&&(n.value.send(JSON.stringify({text:g.value.getHTML(),force:0})),k.value=g.value.getHTML(),Y.success("自动保存"))},18e4)},n.value.onmessage=function(v){let R=JSON.parse(v.data);Array.isArray(JSON.parse(v.data))?R.length>0?t.commit("setEditions",JSON.parse(v.data)):g.value.commands.setContent("<p></p>"):t.commit("addEdition",R),t.commit("changeEdition",-1)},n.value.onclose=function(v){Y.warning("网络刷新"),n.value=new WebSocket(`ws://82.156.154.154:4880/api/v1/ws/doc/${x}`)}}function i(){return console.log(t.state.Doc.Project),t.state.Doc.Project}function c(){return t.state.Doc.Doc}function d(){return t.getters.getCurrentEdition}function u(){return t.getters.getEditions}ee(()=>d(),(x,v)=>{x===0&&s(),x>0&&(g.value.commands.setContent(u()[x].content),Y.success("回退版本"),t.commit("changeEdition",-1))},{deep:!0});function f(){return l(["#958DF1","#F98181","#FBBC88","#FAF594","#70CFF8","#94FADB","#B9F18D"])}const p=L({name:r().user_name,color:f()}),h=L(null),w=L("connecting"),b=L(i().name+"/"+c().document_name),S=new ct,g=at({content:"<p>I’m running Tiptap with Vue.js. 🎉</p>",extensions:[Se.configure({history:!1})]}),k=L("");St(()=>{h.value=new dt({appId:"7j9y6m10",name:b.value,document:S}),h.value.on("status",x=>{w.value=x.status}),localStorage.setItem("currentUser",JSON.stringify(p.value)),g.value=new ut({extensions:[Se.configure({history:!1}),ft,pt,ht,zo.configure({resizable:!0}),Oe,We,Ho,Oe,We,gt,mt.configure({document:S}),bt.configure({provider:h.value,user:p.value}),wt.configure({limit:1e4})]}),a()}),L(!1),_t(()=>{s(),clearInterval(o),g.value.destroy(),h.value.destroy()});function T(){return g.value==null?"":g.value.getText()}function A(){return g.value==null?"":g.value.getHTML()}ee(()=>T(),(x,v)=>{let R=0;if(x.length>v.length){for(let E=0;E<x.length&&E<v.length;E++)if(x[E]!==v[E]){x[E]==="@"&&t.commit("changeAtNeed",R);break}else v[E]==="@"&&R++;x[x.length-1]==="@"&&t.commit("changeAtNeed",R)}},{deep:!0});function H(x,v){let R=0,E=A();console.log(E);for(let Z=0;Z<E.length;Z++)if(E[Z]==="@"&&R++,R===x+1){let et=E.slice(0,Z+1)+v+E.slice(Z+1);g.value.commands.setContent(et);break}}function F(){return t.state.Doc.atString}return ee(()=>F(),(x,v)=>{x!==""&&(H(t.state.Doc.atNeed,x),t.commit("changeAtNeed",-1),t.commit("changeAtString",""))},{deep:!0}),(x,v)=>y(g)?(O(),P("div",Lo,[y(g)?(O(),P("div",$o,[N(y(Ct),{class:"bubble-menu","tippy-options":{duration:100},editor:y(g)},{default:I(()=>[m("button",{onClick:v[0]||(v[0]=R=>y(g).chain().focus().toggleBold().run()),class:U({"is-active":y(g).isActive("bold")}),style:{display:"inline-block",padding:"3px 10px","font-size":"5px",cursor:"pointer","text-align":"center","text-decoration":"none",outline:"none",color:"#fff","background-color":"rgba(210,146,209,0.96)",border:"none","border-radius":"5px"}}," Bold ",2),m("button",{onClick:v[1]||(v[1]=R=>y(g).chain().focus().toggleItalic().run()),class:U({"is-active":y(g).isActive("italic")}),style:{display:"inline-block",padding:"3px 10px","font-size":"5px",cursor:"pointer","text-align":"center","text-decoration":"none",outline:"none",color:"#fff","background-color":"rgba(210,146,209,0.96)",border:"none","border-radius":"5px"}}," Italic ",2),m("button",{onClick:v[2]||(v[2]=R=>y(g).chain().focus().toggleStrike().run()),class:U({"is-active":y(g).isActive("strike")}),style:{display:"inline-block",padding:"3px 10px","font-size":"5px",cursor:"pointer","text-align":"center","text-decoration":"none",outline:"none",color:"#fff","background-color":"rgba(210,146,209,0.96)",border:"none","border-radius":"5px"}}," Strike ",2)]),_:1},8,["editor"]),N(y(vt),{class:"floating-menu","tippy-options":{duration:100},editor:y(g)},{default:I(()=>[m("button",{onClick:v[3]||(v[3]=R=>y(g).chain().focus().toggleHeading({level:1}).run()),class:U({"is-active":y(g).isActive("heading",{level:1})}),style:{display:"inline-block",padding:"3px 10px","font-size":"5px",cursor:"pointer","text-align":"center","text-decoration":"none",outline:"none",color:"#fff","background-color":"rgba(210,146,209,0.96)",border:"none","border-radius":"5px"}}," H1 ",2),m("button",{onClick:v[4]||(v[4]=R=>y(g).chain().focus().toggleHeading({level:2}).run()),class:U({"is-active":y(g).isActive("heading",{level:2})}),style:{display:"inline-block",padding:"3px 10px","font-size":"5px",cursor:"pointer","text-align":"center","text-decoration":"none",outline:"none",color:"#fff","background-color":"rgba(210,146,209,0.96)",border:"none","border-radius":"5px"}}," H2 ",2),m("button",{onClick:v[5]||(v[5]=R=>y(g).chain().focus().toggleBulletList().run()),class:U({"is-active":y(g).isActive("bulletList")}),style:{display:"inline-block",padding:"3px 10px","font-size":"5px",cursor:"pointer","text-align":"center","text-decoration":"none",outline:"none",color:"#fff","background-color":"rgba(210,146,209,0.96)",border:"none","border-radius":"5px"}}," Bullet List ",2),m("button",{onClick:v[6]||(v[6]=R=>y(g).chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()),style:{display:"inline-block",padding:"3px 10px","font-size":"5px",cursor:"pointer","text-align":"center","text-decoration":"none",outline:"none",color:"#fff","background-color":"rgba(210,146,209,0.96)",border:"none","border-radius":"5px"}}," insertTable ")]),_:1},8,["editor"])])):_e("",!0),N(yt,{class:"editor__header",editor:y(g)},null,8,["editor"]),N(y(xt),{class:"editor__content",editor:y(g)},null,8,["editor"]),m("div",Do,[m("div",{class:U(`editor__status editor__status--${w.value}`)},[w.value==="connected"?(O(),P(te,{key:0},[X(q(y(g).storage.collaborationCursor.users.length)+" user"+q(y(g).storage.collaborationCursor.users.length===1?"":"s")+" online in "+q(b.value),1)],64)):(O(),P(te,{key:1},[X(" offline ")],64))],2),m("div",Bo,q(p.value.name),1)])])):_e("",!0)}};const K=e=>(Mt("data-v-cdd2afc6"),e=e(),Tt(),e),Io={class:"toolBar",style:{"border-radius":"20px 0 0 0","box-shadow":"-10px -2.5px 0 0 rgb(225, 235, 248)","min-width":"130px"}},Wo=K(()=>m("div",{class:"icons"},[m("div",{class:"icon icon--doc"},[m("i",{title:"doc"})])],-1)),Oo=K(()=>m("div",{class:"folder-name"},"doc",-1)),Po=[Wo,Oo],jo=K(()=>m("div",{class:"icons"},[m("div",{class:"icon icon--doc",style:{"background-color":"rgb(202, 80, 63)"}},[m("i",{title:"pdf"})])],-1)),Vo=K(()=>m("div",{class:"folder-name"},"pdf",-1)),Jo=[jo,Vo],Ko=K(()=>m("div",{class:"icons"},[m("div",{class:"icon icon--doc",style:{"background-color":"rgb(197, 195, 195)"}},[m("i",{title:"md"})])],-1)),Uo=K(()=>m("div",{class:"folder-name"},"markdown",-1)),Xo=[Ko,Uo],qo=K(()=>m("div",{class:"icons"},[m("div",{class:"icon icon--doc",style:{"background-color":"rgb(153, 210, 205)"}},[m("i",{title:"html"})])],-1)),Go=K(()=>m("div",{class:"folder-name"},"html",-1)),Yo=[qo,Go],Qo={class:"scrollable-container"},Zo=["onClick"],en={class:"edit-time"},tn={class:"edit-name"},on=["onClick"],nn={class:"at-avatar"},ln=["src"],rn={class:"at-name"},sn={__name:"doc",setup(e){const t=Ve(),n=kt(),o=L(a()),l=L(w());function r(){return t.getters.getUserinfo}function s(){return t.state.Doc.Doc}function a(){return t.getters.getEditions}const i=L(!1);ee(()=>a(),(S,g)=>{o.value=a()},{deep:!0}),ee(()=>u(),(S,g)=>{S!==-1&&(i.value=!0)},{deep:!0});function c(S){t.commit("changeEdition",S)}function d(){n.back()}function u(){return t.state.Doc.atNeed}function f(){t.commit("changeEdition",0)}function p(S){pe({url:S,method:"GET",responseType:"blob"}).then(g=>{const k=new Blob([g.data]);let T=S.split("/");console.log(T[T.length-1]),Nt.saveAs(k,T[T.length-1])}).catch(g=>{console.error(g)})}function h(S){t.commit("changeEdition",0);let g=null;g=setInterval(()=>{t.getters.getCurrentEdition===-1&&(clearInterval(g),pe({url:"#/api/v1/doc_edit/export_doc/",method:"post",data:JSON.stringify({doc_id:s().document_id,name:s().document_name,text:a()[0].content,type:S})}).then(k=>{console.log(k.data),k.data.errno===0&&p(k.data.data.url)}).catch(k=>{console.log(k)}))},500)}function w(){return t.getters.getMembers}function b(S){console.log(s()),pe({url:"#/api/v1/notice_center/doc_at",method:"post",data:JSON.stringify({doc_id:s().document_id,token:r().token,ated_user_id:S.id})}).then(g=>{console.log(g.data),t.commit("changeAtString",S.name),i.value=!1,Y.success("@成功")}).catch(g=>{console.log(g)})}return(S,g)=>{const k=Ae("el-icon"),T=Ae("el-popover");return O(),P(te,null,[m("div",Io,[m("div",{class:"header",onClick:d},[N(k,{class:"return"},{default:I(()=>[N(y(Rt))]),_:1}),X(" 返回 ")]),m("ul",null,[N(T,{placement:"right-end",width:180,trigger:"click"},{reference:I(()=>[m("li",null,[N(y(ne),{icon:["fas","download"],style:{position:"relative",top:"5px","font-size":"23px","margin-left":"16px","margin-right":"9px"}}),X("下载 ")])]),default:I(()=>[m("div",{class:"folder-block",onClick:g[0]||(g[0]=A=>h(3))},Po),m("div",{class:"folder-block",onClick:g[1]||(g[1]=A=>h(4))},Jo),m("div",{class:"folder-block",onClick:g[2]||(g[2]=A=>h(1))},Xo),m("div",{class:"folder-block",onClick:g[3]||(g[3]=A=>h(2))},Yo)]),_:1}),m("li",{onClick:f},[N(y(ne),{icon:["far","floppy-disk"],style:{position:"relative",top:"5px","font-size":"23px","margin-left":"16px","margin-right":"12px"}}),X("保存 ")]),N(T,{placement:"right-end",width:270,trigger:"click"},{reference:I(()=>[m("li",null,[N(y(ne),{icon:["fas","clock-rotate-left"],style:{position:"relative",top:"5px","font-size":"23px","margin-left":"16px","margin-right":"8px"}}),X("历史版本 ")])]),default:I(()=>[m("div",Qo,[(O(!0),P(te,null,ke(o.value,(A,H)=>(O(),P("div",{key:H,class:"edit-block",onClick:F=>c(H)},[m("div",en,q(A.edit_time),1),m("div",tn,"编辑人:   "+q(A.editor_name),1)],8,Zo))),128))])]),_:1}),N(T,{visible:i.value,placement:"bottom-end",width:200},{reference:I(()=>[m("li",null,[N(y(ne),{icon:["fas","at"],style:{position:"relative",top:"5px","font-size":"23px","margin-left":"16px","margin-right":"8px"}}),X("At ")])]),default:I(()=>[(O(!0),P(te,null,ke(l.value,(A,H)=>(O(),P("div",{onClick:F=>b(A),key:H,class:"at-block"},[m("div",nn,[m("img",{style:{height:"30px",width:"30px","border-radius":"50%"},src:A.avatar,alt:"Avatar"},null,8,ln)]),m("div",rn,q(A.name),1)],8,on))),128))]),_:1},8,["visible"])])]),N(Fo)],64)}}},fn=At(sn,[["__scopeId","data-v-cdd2afc6"]]);export{fn as default};
